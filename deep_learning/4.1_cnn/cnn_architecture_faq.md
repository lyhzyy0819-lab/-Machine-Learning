# CNN æ¶æ„è®¾è®¡å¸¸è§é—®é¢˜ (FAQ)

> æœ¬æ–‡æ¡£æ•´ç†äº†å­¦ä¹  CNN æ¶æ„æ—¶å¸¸è§çš„ç–‘æƒ‘ï¼Œè¦†ç›– `4.1_cnn` ç›®å½•å…¨éƒ¨å†…å®¹ã€‚

---

## ç›®å½•

### åŸºç¡€æ¦‚å¿µ
- [Q1: æƒé‡åˆå§‹åŒ–åŸç†](#q1-__init__-ä¸­çš„æƒé‡ä¸ºä»€ä¹ˆè¦è¿™æ ·åˆå§‹åŒ–)
- [Q2: è¾“å…¥å½¢çŠ¶å«ä¹‰](#q2-ä¸ºä»€ä¹ˆè¾“å…¥æ˜¯-1-28-28)
- [Q3: Conv1 æƒé‡å½¢çŠ¶](#q3-ä¸ºä»€ä¹ˆ-conv1-æƒé‡æ˜¯-8-1-3-3)
- [Q4: æ± åŒ–å±‚å¤§å°é€‰æ‹©](#q4-æ± åŒ–å±‚å¿…é¡»æ˜¯-2Ã—2-å—)
- [Q5: å·ç§¯ vs å…¨è¿æ¥](#q5-å·ç§¯æ¯”å…¨è¿æ¥å¥½åœ¨å“ª)
- [Q6: è¾“å‡ºå°ºå¯¸è®¡ç®—](#q6-å¦‚ä½•è®¡ç®—è¾“å‡ºç‰¹å¾å›¾å°ºå¯¸)
- [Q7: Padding å’Œ Stride](#q7-padding-å’Œ-stride-å¦‚ä½•é€‰æ‹©)

### ç½‘ç»œç»„ä»¶
- [Q8: BatchNorm ä½ç½®](#q8-batchnorm-æ”¾åœ¨æ¿€æ´»å‡½æ•°å‰è¿˜æ˜¯å)
- [Q9: Dropout åŸç†](#q9-dropout-è®­ç»ƒå’Œæ¨ç†æ—¶æœ‰ä»€ä¹ˆåŒºåˆ«)
- [Q10: å·ç§¯å±‚æ¢¯åº¦](#q10-å·ç§¯å±‚çš„æ¢¯åº¦å¦‚ä½•è®¡ç®—)

### ç»å…¸æ¶æ„
- [Q11: VGG 3Ã—3 å·ç§¯](#q11-ä¸ºä»€ä¹ˆ-vgg-åªç”¨-3Ã—3-å·ç§¯)
- [Q12: ResNet æ®‹å·®](#q12-resnet-çš„æ®‹å·®è¿æ¥ä¸ºä»€ä¹ˆæœ‰æ•ˆ)
- [Q13: æ¶æ„é€‰æ‹©](#q13-å¦‚ä½•é€‰æ‹©ç½‘ç»œæ¶æ„)

### è¿›é˜¶åº”ç”¨
- [Q14: è¿ç§»å­¦ä¹ ç­–ç•¥](#q14-è¿ç§»å­¦ä¹ ä»€ä¹ˆæ—¶å€™å†»ç»“ä»€ä¹ˆæ—¶å€™å¾®è°ƒ)
- [Q15: æ·±åº¦å¯åˆ†ç¦»å·ç§¯](#q15-æ·±åº¦å¯åˆ†ç¦»å·ç§¯ä¸ºä»€ä¹ˆèƒ½å‹ç¼©å‚æ•°)
- [Q16: å€’æ®‹å·®å—](#q16-mobilenet-å€’æ®‹å·®å—æ˜¯ä»€ä¹ˆ)
- [Q17: é€šé“æ³¨æ„åŠ›](#q17-se-net-é€šé“æ³¨æ„åŠ›å¦‚ä½•å·¥ä½œ)
- [Q18: IoU å’Œ NMS](#q18-ä»€ä¹ˆæ˜¯-iou-å’Œ-nms)

---

## Q1: `__init__` ä¸­çš„æƒé‡ä¸ºä»€ä¹ˆè¦è¿™æ ·åˆå§‹åŒ–ï¼Ÿ

### ä»£ç ç¤ºä¾‹

```python
class SimpleCNN_Numpy:
    def __init__(self):
        # Conv1: 8ä¸ªæ»¤æ³¢å™¨ï¼Œ1ä¸ªè¾“å…¥é€šé“ï¼Œ3Ã—3æ ¸
        self.conv1_w = np.random.randn(8, 1, 3, 3) * np.sqrt(2.0 / (1*3*3))
        self.conv1_b = np.zeros(8)

        # Conv2: 16ä¸ªæ»¤æ³¢å™¨ï¼Œ8ä¸ªè¾“å…¥é€šé“ï¼Œ3Ã—3æ ¸
        self.conv2_w = np.random.randn(16, 8, 3, 3) * np.sqrt(2.0 / (8*3*3))
        self.conv2_b = np.zeros(16)

        # FC1
        self.fc1_w = np.random.randn(784, 64) * np.sqrt(2.0 / 784)
        self.fc1_b = np.zeros(64)

        # FC2
        self.fc2_w = np.random.randn(64, 10) * np.sqrt(2.0 / 64)
        self.fc2_b = np.zeros(10)
```

### æƒé‡å½¢çŠ¶ `(C_out, C_in, k_h, k_w)` çš„å«ä¹‰

| ç»´åº¦ | ç¬¦å· | å«ä¹‰ |
|------|------|------|
| ç¬¬1ç»´ | C_out | è¾“å‡ºé€šé“æ•°ï¼ˆæ»¤æ³¢å™¨æ•°é‡ï¼‰ |
| ç¬¬2ç»´ | C_in | è¾“å…¥é€šé“æ•° |
| ç¬¬3ç»´ | k_h | å·ç§¯æ ¸é«˜åº¦ |
| ç¬¬4ç»´ | k_w | å·ç§¯æ ¸å®½åº¦ |

**ä¸ºä»€ä¹ˆè¿™æ ·æ’åˆ—ï¼Ÿ** å·ç§¯æ“ä½œæ—¶ï¼Œæ¯ä¸ªè¾“å‡ºé€šé“éƒ½éœ€è¦ä¸€ä¸ªå®Œæ•´çš„æ»¤æ³¢å™¨ï¼ˆè¦†ç›–æ‰€æœ‰è¾“å…¥é€šé“ï¼‰ã€‚å½¢çŠ¶ `(C_out, C_in, k_h, k_w)` æ–¹ä¾¿æŒ‰ `c_out` ç´¢å¼•å–å‡ºå¯¹åº”æ»¤æ³¢å™¨ã€‚

### He åˆå§‹åŒ–çš„æ•°å­¦åŸç†

```python
np.random.randn(...) * np.sqrt(2.0 / n_in)
```

è¿™æ˜¯ **He åˆå§‹åŒ–**ï¼ˆåˆå« Kaiming åˆå§‹åŒ–ï¼‰ï¼Œä¸“é—¨ä¸º ReLU æ¿€æ´»å‡½æ•°è®¾è®¡ã€‚

**ä¸ºä»€ä¹ˆä¸èƒ½ç®€å•ç”¨ `np.random.randn()`ï¼Ÿ**

- **æƒé‡å¤ªå¤§** â†’ å‰å‘ä¼ æ’­æ—¶æ•°å€¼çˆ†ç‚¸ï¼Œæ¢¯åº¦ä¹Ÿçˆ†ç‚¸
- **æƒé‡å¤ªå°** â†’ ä¿¡å·é€å±‚è¡°å‡ï¼Œæ¢¯åº¦æ¶ˆå¤±

**ç›®æ ‡**ï¼šè®©æ¯å±‚è¾“å‡ºçš„æ–¹å·®ä¿æŒç¨³å®šï¼ˆä¸æ”¾å¤§ä¹Ÿä¸ç¼©å°ï¼‰

å¯¹äº ReLU æ¿€æ´»å‡½æ•°ï¼š
```
Var(output) = Var(input) Ã— (n_in / 2) Ã— Var(W)
```

è¦è®© `Var(output) = Var(input)`ï¼Œéœ€è¦ï¼š
```
Var(W) = 2 / n_in
std(W) = sqrt(2 / n_in)
```

**å„å±‚çš„ n_in è®¡ç®—**ï¼š

| å±‚ | n_in è®¡ç®— | å€¼ |
|---|---|---|
| conv1 | 1 Ã— 3 Ã— 3 | 9 |
| conv2 | 8 Ã— 3 Ã— 3 | 72 |
| fc1 | 784 | 784 |
| fc2 | 64 | 64 |

### åç½®ä¸ºä»€ä¹ˆåˆå§‹åŒ–ä¸º 0ï¼Ÿ

- åç½®å¯¹ç§°æ€§ä¸æ˜¯é—®é¢˜ï¼ˆä¸åƒæƒé‡é‚£æ ·éœ€è¦æ‰“ç ´å¯¹ç§°ï¼‰
- é…åˆ He åˆå§‹åŒ–çš„æƒé‡ï¼Œ0 åç½®è¶³å¤Ÿè®©ç½‘ç»œæ­£å¸¸å¯åŠ¨
- è®­ç»ƒè¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨å­¦ä¹ åˆ°åˆé€‚çš„åç½®å€¼

---

## Q2: ä¸ºä»€ä¹ˆè¾“å…¥æ˜¯ `(1, 28, 28)`ï¼Ÿ

### ä¸‰ä¸ªç»´åº¦çš„å«ä¹‰

| ç»´åº¦ | å€¼ | å«ä¹‰ |
|------|-----|------|
| **1** | C (é€šé“æ•°) | MNIST æ˜¯ç°åº¦å›¾ï¼Œåªæœ‰1ä¸ªé¢œè‰²é€šé“ |
| **28** | H (é«˜åº¦) | å›¾ç‰‡é«˜åº¦ 28 åƒç´  |
| **28** | W (å®½åº¦) | å›¾ç‰‡å®½åº¦ 28 åƒç´  |

### å¯¹æ¯”ï¼šå½©è‰²å›¾ç‰‡ vs ç°åº¦å›¾ç‰‡

```
ç°åº¦å›¾ (MNIST):     (1, 28, 28)   â† 1ä¸ªé€šé“
å½©è‰²å›¾ (RGB):       (3, H, W)     â† 3ä¸ªé€šé“ (çº¢ã€ç»¿ã€è“)
```

### ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨ `(28, 28)`ï¼Ÿ

è™½ç„¶ç°åº¦å›¾æœ¬è´¨ä¸Šæ˜¯äºŒç»´çš„ï¼Œä½†ä¿æŒ `(C, H, W)` æ ¼å¼æœ‰å‡ ä¸ªåŸå› ï¼š

1. **ç»Ÿä¸€æ¥å£**ï¼šå·ç§¯å±‚è®¾è®¡ä¸ºå¤„ç†å¤šé€šé“è¾“å…¥ï¼Œç”¨ `(1, 28, 28)` ä¿æŒæ¥å£ä¸€è‡´

2. **ä»£ç å¤ç”¨**ï¼šåŒä¸€ä¸ª `conv2d` å‡½æ•°æ—¢èƒ½å¤„ç†ç°åº¦å›¾ä¹Ÿèƒ½å¤„ç†å½©è‰²å›¾

3. **å·ç§¯æ ¸åŒ¹é…**ï¼š
   ```python
   # å·ç§¯æ ¸å½¢çŠ¶: (C_out, C_in, k_h, k_w)
   self.conv1_w = np.random.randn(8, 1, 3, 3)
   #                              â†‘  â†‘
   #                         8ä¸ªè¾“å‡º 1ä¸ªè¾“å…¥é€šé“
   ```
   è¾“å…¥çš„é€šé“ç»´åº¦ `1` å¿…é¡»å’Œå·ç§¯æ ¸çš„ `C_in=1` åŒ¹é…

### æ•°æ®æµç¤ºæ„

```
åŸå§‹ MNIST æ•°æ®: (28, 28) äºŒç»´æ•°ç»„
       â”‚
       â–¼ reshape æˆ– expand_dims
CNN è¾“å…¥æ ¼å¼: (1, 28, 28)
       â”‚
       â–¼ conv2d
è¾“å‡º: (8, 28, 28)  â† 8ä¸ªé€šé“äº†
```

### æ‰¹å¤„ç†æ—¶çš„å½¢çŠ¶

å®é™…è®­ç»ƒæ—¶è¿˜ä¼šåŠ ä¸€ä¸ª batch ç»´åº¦ï¼š

```
å•å¼ å›¾ç‰‡:  (1, 28, 28)        â†’ (C, H, W)
ä¸€æ‰¹å›¾ç‰‡:  (64, 1, 28, 28)    â†’ (N, C, H, W)
           â†‘
        batch_size=64
```

---

## Q3: ä¸ºä»€ä¹ˆ Conv1 æƒé‡æ˜¯ `(8, 1, 3, 3)`ï¼Ÿ

### æ¯ä¸ªç»´åº¦çš„å«ä¹‰å’Œè®¾è®¡ç†ç”±

| ç»´åº¦ | å€¼ | å«ä¹‰ | ä¸ºä»€ä¹ˆé€‰è¿™ä¸ªå€¼ï¼Ÿ |
|------|-----|------|------------------|
| **8** | C_out | è¾“å‡ºé€šé“æ•°ï¼ˆæ»¤æ³¢å™¨æ•°é‡ï¼‰ | è®¾è®¡é€‰æ‹©ï¼Œå¯ä»¥æ˜¯ä»»æ„å€¼ |
| **1** | C_in | è¾“å…¥é€šé“æ•° | **å¿…é¡»**ä¸è¾“å…¥åŒ¹é…ï¼ˆMNISTç°åº¦å›¾=1ï¼‰ |
| **3** | k_h | å·ç§¯æ ¸é«˜åº¦ | å¸¸ç”¨é€‰æ‹©ï¼Œ3Ã—3 æ˜¯æœ€æµè¡Œçš„ |
| **3** | k_w | å·ç§¯æ ¸å®½åº¦ | åŒä¸Š |

### è¯¦ç»†è§£é‡Š

#### 1. ä¸ºä»€ä¹ˆ `C_in = 1`ï¼Ÿï¼ˆå¿…é¡»çš„ï¼‰

è¿™æ˜¯**è¢«åŠ¨å†³å®šçš„**ï¼Œå¿…é¡»å’Œè¾“å…¥æ•°æ®çš„é€šé“æ•°åŒ¹é…ï¼š

```
è¾“å…¥å›¾ç‰‡: (1, 28, 28)
           â†‘
           1ä¸ªé€šé“ï¼ˆç°åº¦å›¾ï¼‰

æ‰€ä»¥ conv1 çš„ C_in å¿…é¡» = 1
```

å¦‚æœè¾“å…¥æ˜¯ RGB å½©è‰²å›¾ `(3, H, W)`ï¼Œé‚£ C_in å°±å¿…é¡»æ˜¯ 3ã€‚

#### 2. ä¸ºä»€ä¹ˆ `C_out = 8`ï¼Ÿï¼ˆè®¾è®¡é€‰æ‹©ï¼‰

è¿™æ˜¯**è‡ªç”±é€‰æ‹©çš„**ï¼Œ8 åªæ˜¯ä¸€ä¸ªåˆç†çš„èµ·ç‚¹ï¼š

- **å¤ªå°‘**ï¼ˆå¦‚ 2ï¼‰ï¼šæå–çš„ç‰¹å¾ä¸å¤Ÿä¸°å¯Œ
- **å¤ªå¤š**ï¼ˆå¦‚ 128ï¼‰ï¼šå¯¹äºç®€å•çš„ MNISTï¼Œè®¡ç®—æµªè´¹
- **8** æ˜¯ä¸€ä¸ªå¹³è¡¡ç‚¹ï¼Œè¶³å¤Ÿæ•æ‰è¾¹ç¼˜ã€è§’ç‚¹ç­‰åŸºç¡€ç‰¹å¾

ä½ å®Œå…¨å¯ä»¥æ”¹æˆ 16ã€32 æˆ–å…¶ä»–å€¼ã€‚

#### 3. ä¸ºä»€ä¹ˆ `3Ã—3` å·ç§¯æ ¸ï¼Ÿï¼ˆè¡Œä¸šæ ‡å‡†ï¼‰

**3Ã—3 æ˜¯ç°ä»£ CNN çš„é»„é‡‘æ ‡å‡†**ï¼ŒåŸå› ï¼š

| å·ç§¯æ ¸å¤§å° | ç‰¹ç‚¹ |
|------------|------|
| 1Ã—1 | å¤ªå°ï¼Œåªçœ‹å•ä¸ªåƒç´ ï¼Œæ— æ³•æ•æ‰ç©ºé—´å…³ç³» |
| 3Ã—3 | åˆšå¥½ï¼Œèƒ½çœ‹åˆ°å‘¨å›´ 8 ä¸ªé‚»å±…ï¼Œè®¡ç®—é«˜æ•ˆ |
| 5Ã—5 | å¯ä»¥ç”¨ä¸¤ä¸ª 3Ã—3 æ›¿ä»£ï¼Œä¸”å‚æ•°æ›´å°‘ |
| 7Ã—7 | åªåœ¨ç½‘ç»œå¼€å¤´å¶å°”ä½¿ç”¨ï¼ˆå¦‚ ResNet ç¬¬ä¸€å±‚ï¼‰ |

**æ•°å­¦ä¸Š**ï¼šä¸¤ä¸ª 3Ã—3 å·ç§¯ = ä¸€ä¸ª 5Ã—5 æ„Ÿå—é‡ï¼Œä½†å‚æ•°æ›´å°‘ï¼š
```
5Ã—5: 25 ä¸ªå‚æ•°
3Ã—3 + 3Ã—3: 9 + 9 = 18 ä¸ªå‚æ•°ï¼ˆæ›´å°‘ï¼ï¼‰
```

### å¯è§†åŒ–ï¼š8 ä¸ªæ»¤æ³¢å™¨åœ¨åšä»€ä¹ˆï¼Ÿ

```
è¾“å…¥ (1, 28, 28)
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  8 ä¸ª 3Ã—3 æ»¤æ³¢å™¨ï¼Œæ¯ä¸ªå­¦ä¹ ä¸åŒçš„ç‰¹å¾ï¼š   â”‚
â”‚                                         â”‚
â”‚  æ»¤æ³¢å™¨1: æ£€æµ‹ â”‚ å‚ç›´è¾¹ç¼˜               â”‚
â”‚  æ»¤æ³¢å™¨2: æ£€æµ‹ â”€ æ°´å¹³è¾¹ç¼˜               â”‚
â”‚  æ»¤æ³¢å™¨3: æ£€æµ‹ â•± æ–œè¾¹ç¼˜                 â”‚
â”‚  æ»¤æ³¢å™¨4: æ£€æµ‹ â•² æ–œè¾¹ç¼˜                 â”‚
â”‚  æ»¤æ³¢å™¨5: æ£€æµ‹è§’ç‚¹                      â”‚
â”‚  æ»¤æ³¢å™¨6: æ£€æµ‹çº¹ç†                      â”‚
â”‚  æ»¤æ³¢å™¨7: ...                           â”‚
â”‚  æ»¤æ³¢å™¨8: ...                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
è¾“å‡º (8, 28, 28)  â† 8 å¼ ç‰¹å¾å›¾
```

### æ€»ç»“

| å‚æ•° | æ€§è´¨ | è¯´æ˜ |
|------|------|------|
| `C_in = 1` | **å¼ºåˆ¶** | å¿…é¡»åŒ¹é…è¾“å…¥é€šé“æ•° |
| `C_out = 8` | **å¯è°ƒ** | è¶…å‚æ•°ï¼Œå¯ä»¥å°è¯•ä¸åŒå€¼ |
| `k_h = k_w = 3` | **æ¨è** | è¡Œä¸šæ ‡å‡†ï¼Œæ•ˆæœå¥½ä¸”é«˜æ•ˆ |

---

## Q4: æ± åŒ–å±‚å¿…é¡»æ˜¯ 2Ã—2 å—ï¼Ÿ

### æ± åŒ–å±‚å¤§å°æ˜¯å¯ä»¥è‡ªç”±é€‰æ‹©çš„

2Ã—2 åªæ˜¯æœ€å¸¸ç”¨çš„é€‰æ‹©ï¼Œä¸æ˜¯å¼ºåˆ¶çš„ã€‚

### å¯¹æ¯”è®¡ç®—ï¼š2Ã—2 vs 3Ã—3 æ± åŒ–

#### å½“å‰ï¼š2Ã—2 æ± åŒ–

```
è¾“å…¥: (1, 28, 28)
    â†“ conv1 (padding=1)
(8, 28, 28)
    â†“ max_pool 2Ã—2       28 Ã· 2 = 14
(8, 14, 14)
    â†“ conv2 (padding=1)
(16, 14, 14)
    â†“ max_pool 2Ã—2       14 Ã· 2 = 7
(16, 7, 7)
    â†“ flatten
16 Ã— 7 Ã— 7 = 784        â† fc1_w = (784, 64)
```

#### å¦‚æœæ”¹æˆï¼š3Ã—3 æ± åŒ–

```
è¾“å…¥: (1, 28, 28)
    â†“ conv1 (padding=1)
(8, 28, 28)
    â†“ max_pool 3Ã—3       28 Ã· 3 = 9ï¼ˆå‘ä¸‹å–æ•´ï¼‰
(8, 9, 9)
    â†“ conv2 (padding=1)
(16, 9, 9)
    â†“ max_pool 3Ã—3       9 Ã· 3 = 3
(16, 3, 3)
    â†“ flatten
16 Ã— 3 Ã— 3 = 144        â† fc1_w = (144, 64)
```

### ç­”æ¡ˆæ±‡æ€»

| æ± åŒ–å¤§å° | flatten åç»´åº¦ | fc1_w å½¢çŠ¶ |
|----------|----------------|------------|
| 2Ã—2 | 16 Ã— 7 Ã— 7 = **784** | (784, 64) |
| 3Ã—3 | 16 Ã— 3 Ã— 3 = **144** | (144, 64) |

### ä¸ºä»€ä¹ˆ 2Ã—2 æœ€å¸¸ç”¨ï¼Ÿ

| æ± åŒ–å¤§å° | ç‰¹ç‚¹ |
|----------|------|
| **2Ã—2** | å°ºå¯¸å‡åŠï¼Œä¿¡æ¯ä¿ç•™è¾ƒå¤šï¼Œæœ€å¸¸ç”¨ |
| **3Ã—3** | å°ºå¯¸ç¼©å°æ›´å¿«ï¼Œä¿¡æ¯æŸå¤±æ›´å¤š |
| **4Ã—4** | å¾ˆå°‘ç”¨ï¼Œä¸‹é‡‡æ ·å¤ªæ¿€è¿› |

**ç»éªŒæ³•åˆ™**ï¼š
- 2Ã—2 æ± åŒ– + stride=2 æ˜¯æ ‡å‡†é…ç½®
- ç°ä»£ç½‘ç»œæœ‰æ—¶ç”¨ stride=2 çš„å·ç§¯ä»£æ›¿æ± åŒ–

### æ³¨æ„ï¼š28 ä¸èƒ½è¢« 3 æ•´é™¤

```python
28 Ã· 3 = 9.33... â†’ å‘ä¸‹å–æ•´ä¸º 9
```

è¿™æ„å‘³ç€ä¼šä¸¢å¤±è¾¹ç¼˜çš„ä¸€äº›åƒç´ ã€‚å¦‚æœè¾“å…¥å°ºå¯¸èƒ½è¢«æ± åŒ–å¤§å°æ•´é™¤ä¼šæ›´å¹²å‡€ï¼ˆå¦‚ 27Ã—27 å›¾ç‰‡ç”¨ 3Ã—3 æ± åŒ–ï¼‰ã€‚

---

## é™„å½•ï¼šå®Œæ•´æ¶æ„å¯è§†åŒ–

```
SimpleCNN_Numpy æ¶æ„:

è¾“å…¥ (1, 28, 28)
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Conv1: (8, 1, 3, 3)    â”‚  â† 8ä¸ªæ»¤æ³¢å™¨ï¼Œæ¯ä¸ªå¤„ç†1ä¸ªé€šé“
â”‚  He init: sqrt(2/9)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼ ReLU â†’ MaxPool(2Ã—2)

(8, 14, 14)
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Conv2: (16, 8, 3, 3)   â”‚  â† 16ä¸ªæ»¤æ³¢å™¨ï¼Œæ¯ä¸ªå¤„ç†8ä¸ªé€šé“
â”‚  He init: sqrt(2/72)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼ ReLU â†’ MaxPool(2Ã—2) â†’ Flatten

(784,)
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FC1: (784, 64)         â”‚
â”‚  He init: sqrt(2/784)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼ ReLU

(64,)
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FC2: (64, 10)          â”‚  â† 10ç±»è¾“å‡º
â”‚  He init: sqrt(2/64)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
è¾“å‡º (10,) â†’ åˆ†ç±» logits
```

---

## Q5: å·ç§¯æ¯”å…¨è¿æ¥å¥½åœ¨å“ªï¼Ÿ

> æ¥æºï¼š01_why_convolution.ipynb

### å‚æ•°é‡å¯¹æ¯”

å‡è®¾è¾“å…¥æ˜¯ 224Ã—224Ã—3 çš„ RGB å›¾åƒï¼Œè¾“å‡º 1000 ä¸ªç¥ç»å…ƒï¼š

| å±‚ç±»å‹ | å‚æ•°è®¡ç®— | å‚æ•°é‡ |
|--------|----------|--------|
| **å…¨è¿æ¥** | 224 Ã— 224 Ã— 3 Ã— 1000 | **1.5 äº¿** |
| **3Ã—3 å·ç§¯** | 3 Ã— 3 Ã— 3 Ã— 64 | **1,728** |

å·®äº† **10 ä¸‡å€**ï¼

### å·ç§¯çš„ä¸‰å¤§ä¼˜åŠ¿

```
1. å±€éƒ¨è¿æ¥ï¼šæ¯ä¸ªè¾“å‡ºåªçœ‹å±€éƒ¨ KÃ—K åŒºåŸŸ
   - ç›¸é‚»åƒç´ ç›¸å…³æ€§é«˜ï¼Œè¿œå¤„åƒç´ æ— å…³

2. æƒå€¼å…±äº«ï¼šåŒä¸€å·ç§¯æ ¸å¤ç”¨
   - ä¸€å¼ å›¾çš„å·¦è¾¹å­¦åˆ°çš„è¾¹ç¼˜æ£€æµ‹å™¨ï¼Œå³è¾¹ä¹Ÿèƒ½ç”¨

3. å¹³ç§»ä¸å˜æ€§ï¼šçŒ«åœ¨å·¦è¾¹è¿˜æ˜¯å³è¾¹éƒ½æ˜¯çŒ«
   - åŒä¸€ç‰¹å¾åœ¨ä»»ä½•ä½ç½®éƒ½èƒ½æ£€æµ‹åˆ°
```

### å¯è§†åŒ–ç†è§£

```
å…¨è¿æ¥ï¼šæ¯ä¸ªè¾“å‡ºè¿æ¥æ‰€æœ‰è¾“å…¥ (O(HÃ—WÃ—C))
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â—â”€â—â”€â—â”€â—â”€â—â”€â—â”€â—â”€â—â”€â—â”€â—â”€â—â”€â—â”‚ â† å…¨è¿æ¥
â”‚ â•²â•±â•²â•±â•²â•±â•²â•±â•²â•±â•²â•±â•²â•±â•²â•±â•²â•±â•²â•±â•²â•± â”‚
â”‚ â—â”€â—â”€â—â”€â—â”€â—â”€â—â”€â—â”€â—â”€â—â”€â—â”€â—â”€â—â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å·ç§¯ï¼šæ¯ä¸ªè¾“å‡ºåªçœ‹ 3Ã—3 é‚»åŸŸ (O(KÃ—KÃ—C))
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      â”Œâ”€â”€â”€â”             â”‚
â”‚      â”‚3Ã—3â”‚â†’ â—          â”‚ â† å±€éƒ¨è¿æ¥
â”‚      â””â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Q6: å¦‚ä½•è®¡ç®—è¾“å‡ºç‰¹å¾å›¾å°ºå¯¸ï¼Ÿ

> æ¥æºï¼š02_convolution_math.ipynb

### æ ¸å¿ƒå…¬å¼ â­

$$H_{out} = \left\lfloor \frac{H_{in} + 2P - K}{S} \right\rfloor + 1$$

| ç¬¦å· | å«ä¹‰ |
|------|------|
| H_in | è¾“å…¥é«˜åº¦ |
| P | Paddingï¼ˆå¡«å……ï¼‰ |
| K | Kernel sizeï¼ˆå·ç§¯æ ¸å¤§å°ï¼‰ |
| S | Strideï¼ˆæ­¥å¹…ï¼‰ |

### å¸¸ç”¨é…ç½®é€ŸæŸ¥

| é…ç½® | è¾“å…¥ | è¾“å‡º | æ•ˆæœ |
|------|------|------|------|
| K=3, P=1, S=1 | 28 | 28 | **å°ºå¯¸ä¸å˜** |
| K=3, P=1, S=2 | 28 | 14 | **å°ºå¯¸å‡åŠ** |
| K=5, P=2, S=1 | 28 | 28 | å°ºå¯¸ä¸å˜ |
| K=7, P=3, S=2 | 224 | 112 | å°ºå¯¸å‡åŠ |

### Same Padding å¿«é€Ÿè®¡ç®—

æƒ³è®©è¾“å‡ºå°ºå¯¸ = è¾“å…¥å°ºå¯¸ï¼ˆstride=1 æ—¶ï¼‰ï¼š

```python
P = K // 2

# ä¾‹å¦‚ï¼šK=3 â†’ P=1
#      K=5 â†’ P=2
#      K=7 â†’ P=3
```

### æ‰‹ç®—ç»ƒä¹ 

```
è¾“å…¥: 32Ã—32, K=5, P=0, S=1
è¾“å‡º: (32 + 0 - 5) / 1 + 1 = 28Ã—28

è¾“å…¥: 32Ã—32, K=3, P=1, S=2
è¾“å‡º: (32 + 2 - 3) / 2 + 1 = 16Ã—16
```

---

## Q7: Padding å’Œ Stride å¦‚ä½•é€‰æ‹©ï¼Ÿ

> æ¥æºï¼š02_convolution_math.ipynb

### Padding é€‰æ‹©

| Padding å€¼ | ä½œç”¨ | ä½¿ç”¨åœºæ™¯ |
|------------|------|----------|
| **P=0** | ä¸å¡«å……ï¼Œå°ºå¯¸ä¼šç¼©å° | å¾ˆå°‘ç”¨ |
| **P=K//2** | Same paddingï¼Œå°ºå¯¸ä¸å˜ | **æœ€å¸¸ç”¨** |
| **P=K-1** | Full paddingï¼Œå°ºå¯¸å¢å¤§ | å‡ ä¹ä¸ç”¨ |

### Stride é€‰æ‹©

| Stride å€¼ | ä½œç”¨ | ä½¿ç”¨åœºæ™¯ |
|-----------|------|----------|
| **S=1** | ä¸ä¸‹é‡‡æ · | ç‰¹å¾æå–å±‚ |
| **S=2** | å°ºå¯¸å‡åŠ | æ›¿ä»£æ± åŒ–å±‚çš„ä¸‹é‡‡æ · |

### ç°ä»£ç½‘ç»œçš„è¶‹åŠ¿

```python
# ä¼ ç»Ÿåšæ³•ï¼šå·ç§¯ + æ± åŒ–ä¸‹é‡‡æ ·
nn.Conv2d(64, 128, 3, padding=1)   # å°ºå¯¸ä¸å˜
nn.MaxPool2d(2)                     # å°ºå¯¸å‡åŠ

# ç°ä»£åšæ³•ï¼šç”¨ stride=2 å·ç§¯æ›¿ä»£æ± åŒ–
nn.Conv2d(64, 128, 3, stride=2, padding=1)  # åŒæ—¶æå–ç‰¹å¾ + ä¸‹é‡‡æ ·
```

**ä¼˜ç‚¹**ï¼šå‚æ•°å¯å­¦ä¹ ï¼Œæ›´çµæ´»

---

## Q8: BatchNorm æ”¾åœ¨æ¿€æ´»å‡½æ•°å‰è¿˜æ˜¯åï¼Ÿ

> æ¥æºï¼š05_cnn_architecture.ipynb

### ä¸¤ç§æµæ´¾

```python
# æ–¹å¼1ï¼šBN åœ¨æ¿€æ´»å‰ï¼ˆåŸè®ºæ–‡ï¼‰
x = conv(x)
x = bn(x)
x = relu(x)

# æ–¹å¼2ï¼šBN åœ¨æ¿€æ´»åï¼ˆéƒ¨åˆ†å®è·µï¼‰
x = conv(x)
x = relu(x)
x = bn(x)
```

### å®é™…æ¨è

**å¤§å¤šæ•°æƒ…å†µç”¨æ–¹å¼1**ï¼ˆConv â†’ BN â†’ ReLUï¼‰

åŸå› ï¼š
1. åŸè®ºæ–‡å°±æ˜¯è¿™æ ·
2. BN æŠŠæ•°æ®å½’ä¸€åŒ–åˆ°å‡å€¼ 0ï¼ŒReLU æ­£å¥½ä»¥ 0 ä¸ºåˆ†ç•Œç‚¹
3. å®éªŒè¯æ˜æ•ˆæœå·®ä¸å¤šï¼Œä½†æ–¹å¼1 æ›´ä¸»æµ

### BatchNorm çš„ä½œç”¨

```python
# BatchNorm è®¡ç®—è¿‡ç¨‹
x_norm = (x - mean) / sqrt(var + eps)  # æ ‡å‡†åŒ–
y = gamma * x_norm + beta               # ç¼©æ”¾å’Œå¹³ç§»ï¼ˆå¯å­¦ä¹ ï¼‰
```

**å¥½å¤„**ï¼š
1. åŠ é€Ÿæ”¶æ•›
2. å…è®¸æ›´å¤§å­¦ä¹ ç‡
3. å‡å°‘å¯¹åˆå§‹åŒ–çš„æ•æ„Ÿæ€§
4. è½»å¾®æ­£åˆ™åŒ–æ•ˆæœ

---

## Q9: Dropout è®­ç»ƒå’Œæ¨ç†æ—¶æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

> æ¥æºï¼š05_cnn_architecture.ipynb

### è®­ç»ƒæ—¶

```python
# éšæœºå°†éƒ¨åˆ†ç¥ç»å…ƒç½® 0
mask = np.random.rand(*x.shape) > p  # p æ˜¯ dropout ç‡
x_dropout = x * mask
x_dropout = x_dropout / (1 - p)       # ç¼©æ”¾ï¼ˆInverted Dropoutï¼‰
```

### æ¨ç†æ—¶

```python
# ä»€ä¹ˆéƒ½ä¸åšï¼Œç›´æ¥ä½¿ç”¨åŸå§‹è¾“å‡º
x_output = x
```

### ä¸ºä»€ä¹ˆè¦ç¼©æ”¾ï¼Ÿï¼ˆInverted Dropoutï¼‰

è®­ç»ƒæ—¶ä¸¢å¼ƒ p æ¯”ä¾‹çš„ç¥ç»å…ƒï¼Œè¾“å‡ºæœŸæœ›å˜ä¸ºåŸæ¥çš„ (1-p) å€ã€‚

ä¸ºäº†è®©è®­ç»ƒå’Œæ¨ç†æ—¶çš„æ•°å€¼å°ºåº¦ä¸€è‡´ï¼Œæœ‰ä¸¤ç§æ–¹æ¡ˆï¼š

| æ–¹æ¡ˆ | è®­ç»ƒæ—¶ | æ¨ç†æ—¶ |
|------|--------|--------|
| æ ‡å‡† Dropout | ä¸ç¼©æ”¾ | ä¹˜ä»¥ (1-p) |
| **Inverted Dropout** | é™¤ä»¥ (1-p) | **ä¸å¤„ç†** |

**Inverted Dropout æ›´æµè¡Œ**ï¼Œå› ä¸ºæ¨ç†æ—¶ä¸éœ€è¦é¢å¤–æ“ä½œã€‚

### PyTorch ä»£ç 

```python
# PyTorch ç”¨çš„å°±æ˜¯ Inverted Dropout
nn.Dropout(p=0.5)

# è®­ç»ƒæ¨¡å¼
model.train()  # dropout ç”Ÿæ•ˆ

# æ¨ç†æ¨¡å¼
model.eval()   # dropout å…³é—­
```

---

## Q10: å·ç§¯å±‚çš„æ¢¯åº¦å¦‚ä½•è®¡ç®—ï¼Ÿ

> æ¥æºï¼š06_cnn_backprop.ipynb

### æ ¸å¿ƒæ€æƒ³

å·ç§¯çš„åå‘ä¼ æ’­ = å·ç§¯çš„å·ç§¯ï¼

### å¯¹æƒé‡çš„æ¢¯åº¦

```python
# è¾“å…¥ä¸ä¸Šæ¸¸æ¢¯åº¦åšå·ç§¯
dW = conv2d(input, d_out)
```

### å¯¹è¾“å…¥çš„æ¢¯åº¦

```python
# ä¸Šæ¸¸æ¢¯åº¦ä¸ã€Œæ—‹è½¬180Â°çš„å·ç§¯æ ¸ã€åšå·ç§¯
dX = conv2d(d_out, rotate180(W))
```

### ä¸ºä»€ä¹ˆè¦æ—‹è½¬ 180Â°ï¼Ÿ

```
å‰å‘ï¼šO[i,j] = Î£ X[i+m, j+n] Ã— W[m, n]
åå‘ï¼šdX[i,j] = Î£ dO[i-m, j-n] Ã— W[m, n]
            = Î£ dO[i+m, j+n] Ã— W[-m, -n]  â† ç›¸å½“äºç¿»è½¬
```

### æ± åŒ–å±‚çš„æ¢¯åº¦

**Max Pooling**ï¼š
```python
# æ¢¯åº¦åªæµå‘æœ€å¤§å€¼ä½ç½®
d_input = zeros_like(input)
d_input[max_position] = d_out
```

**Average Pooling**ï¼š
```python
# æ¢¯åº¦å¹³å‡åˆ†é…
d_input = d_out / (pool_h * pool_w)
```

---

## Q11: ä¸ºä»€ä¹ˆ VGG åªç”¨ 3Ã—3 å·ç§¯ï¼Ÿ

> æ¥æºï¼š07_classic_architectures.ipynb, 07a_lenet_alexnet_vgg.ipynb

### æ„Ÿå—é‡ç­‰æ•ˆ

```
2 ä¸ª 3Ã—3 = 1 ä¸ª 5Ã—5 çš„æ„Ÿå—é‡
3 ä¸ª 3Ã—3 = 1 ä¸ª 7Ã—7 çš„æ„Ÿå—é‡
```

### å‚æ•°å¯¹æ¯”

| å·ç§¯é…ç½® | å‚æ•°é‡ (C é€šé“) |
|----------|-----------------|
| 1 ä¸ª 5Ã—5 | 25CÂ² |
| 2 ä¸ª 3Ã—3 | 18CÂ² (å°‘ 28%) |
| 1 ä¸ª 7Ã—7 | 49CÂ² |
| 3 ä¸ª 3Ã—3 | 27CÂ² (å°‘ 45%) |

### é¢å¤–å¥½å¤„

1. **æ›´å¤šéçº¿æ€§**ï¼šæ¯å±‚åé¢è·Ÿä¸€ä¸ª ReLU
2. **æ›´æ·±çš„ç½‘ç»œ**ï¼šç›¸åŒæ„Ÿå—é‡ï¼Œå±‚æ•°æ›´å¤šï¼Œè¡¨è¾¾èƒ½åŠ›æ›´å¼º
3. **å†…å­˜æ•ˆç‡**ï¼šå°å·ç§¯æ ¸è®¡ç®—æ›´é«˜æ•ˆ

### å¯è§†åŒ–

```
5Ã—5 å·ç§¯ï¼ˆ1å±‚ï¼‰:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â—  â—  â—  â—  â—  â”‚ â†’ ReLU
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

3Ã—3 + 3Ã—3ï¼ˆ2å±‚ï¼Œç›¸åŒæ„Ÿå—é‡ï¼‰:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     â—  â—  â—     â”‚ â†’ ReLU â†’â”‚     â—  â—  â—     â”‚ â†’ ReLU
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      æ›´å¤šéçº¿æ€§ï¼
```

---

## Q12: ResNet çš„æ®‹å·®è¿æ¥ä¸ºä»€ä¹ˆæœ‰æ•ˆï¼Ÿ

> æ¥æºï¼š07_classic_architectures.ipynb

### æ ¸å¿ƒæ€æƒ³

```
ä¼ ç»Ÿç½‘ç»œï¼šç›´æ¥å­¦ä¹  H(x)
ResNetï¼šå­¦ä¹ æ®‹å·® F(x) = H(x) - x

è¾“å‡º = F(x) + x
```

### å¯è§†åŒ–

```
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                     â”‚ â† æ’ç­‰æ˜ å°„ (shortcut)
è¾“å…¥ x â”€â”¼â†’ Conv â†’ BN â†’ ReLU â”€â”¼â†’ (+) â†’ ReLU â†’ è¾“å‡º
        â”‚      â†’ Conv â†’ BN   â”‚
        â”‚         F(x)       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸ºä»€ä¹ˆæœ‰æ•ˆï¼Ÿ

**æ•°å­¦è§£é‡Š**ï¼š

$$\frac{\partial H(x)}{\partial x} = \frac{\partial F(x)}{\partial x} + 1$$

æ¢¯åº¦è‡³å°‘ä¸º 1ï¼Œ**æ°¸è¿œä¸ä¼šæ¶ˆå¤±**ï¼

**ç›´è§‚ç†è§£**ï¼š
- å¦‚æœæŸå±‚ä¸éœ€è¦ï¼Œç½‘ç»œå¯ä»¥å­¦ä¹  F(x) = 0ï¼Œè¾“å‡ºå°±ç­‰äºè¾“å…¥
- ç›¸å½“äºç»™äº†ç½‘ç»œä¸€ä¸ªã€Œåæ‚”è¯ã€

### æ·±åº¦å¯¹æ¯”

| ç½‘ç»œ | å¯è®­ç»ƒæ·±åº¦ | åŸå›  |
|------|-----------|------|
| VGG | ~20 å±‚ | æ¢¯åº¦æ¶ˆå¤± |
| ResNet | 152+ å±‚ | æ®‹å·®è¿æ¥ |

---

## Q13: å¦‚ä½•é€‰æ‹©ç½‘ç»œæ¶æ„ï¼Ÿ

> æ¥æºï¼š07_classic_architectures.ipynb, 10_modern_efficient_architectures.ipynb

### å†³ç­–æ ‘

```
ä»»åŠ¡å¤æ‚åº¦ï¼Ÿ
    â”‚
    â”œâ”€â†’ ç®€å•ï¼ˆMNISTï¼‰â”€â”€â”€â†’ 2-3 å±‚ CNN
    â”‚
    â””â”€â†’ å¤æ‚ï¼ˆImageNetï¼‰
            â”‚
            â””â”€â†’ èµ„æºçº¦æŸï¼Ÿ
                    â”‚
                    â”œâ”€â†’ æœ‰ï¼ˆæ‰‹æœº/è¾¹ç¼˜ï¼‰â”€â”€â”€â†’ MobileNet / EfficientNet
                    â”‚
                    â””â”€â†’ æ— ï¼ˆæœåŠ¡å™¨ï¼‰
                            â”‚
                            â”œâ”€â†’ é€šç”¨ä»»åŠ¡ â”€â”€â”€â†’ ResNet-50
                            â”‚
                            â””â”€â†’ è¿½æ±‚æè‡´ â”€â”€â”€â†’ EfficientNet-B7 / ConvNeXt
```

### å¸¸ç”¨æ¶æ„æ¨è

| åœºæ™¯ | æ¨èæ¶æ„ | å‚æ•°é‡ | ç†ç”± |
|------|----------|--------|------|
| å¿«é€ŸéªŒè¯ | ResNet-18 | 11M | è½»é‡ã€æ•ˆæœå¥½ |
| é€šç”¨åŸºçº¿ | ResNet-50 | 25M | å¹³è¡¡æ€§èƒ½å’Œæ•ˆç‡ |
| ç§»åŠ¨ç«¯ | MobileNet V2 | 3.4M | ä¸“ä¸ºç§»åŠ¨è®¾è®¡ |
| è¿½æ±‚ç²¾åº¦ | EfficientNet-B4+ | 19M+ | æœ€ä¼˜æ€§ä»·æ¯” |
| è¿ç§»å­¦ä¹  | ResNet-50 / EfficientNet | - | é¢„è®­ç»ƒæƒé‡æˆç†Ÿ |

---

## Q14: è¿ç§»å­¦ä¹ ä»€ä¹ˆæ—¶å€™å†»ç»“ã€ä»€ä¹ˆæ—¶å€™å¾®è°ƒï¼Ÿ

> æ¥æºï¼š08_transfer_learning.ipynb

### å†³ç­–ä¾æ®

| æ•°æ®é‡ | ä¸é¢„è®­ç»ƒä»»åŠ¡ç›¸ä¼¼åº¦ | ç­–ç•¥ |
|--------|-------------------|------|
| å°‘ | é«˜ | **å†»ç»“**æ‰€æœ‰å±‚ï¼Œåªè®­ç»ƒåˆ†ç±»å¤´ |
| å°‘ | ä½ | å†»ç»“æµ…å±‚ï¼Œå¾®è°ƒæ·±å±‚ |
| å¤š | é«˜ | **å¾®è°ƒ**å…¨éƒ¨ï¼Œå°å­¦ä¹ ç‡ |
| å¤š | ä½ | å¾®è°ƒå…¨éƒ¨ï¼Œæˆ–ä»å¤´è®­ç»ƒ |

### ä¸ºä»€ä¹ˆæµ…å±‚å¯ä»¥å†»ç»“ï¼Ÿ

```
æµ…å±‚ç‰¹å¾ï¼ˆé€šç”¨ï¼‰ï¼šè¾¹ç¼˜ã€çº¹ç†ã€é¢œè‰²
   â†“ å¯å¤ç”¨
æ·±å±‚ç‰¹å¾ï¼ˆä»»åŠ¡ç›¸å…³ï¼‰ï¼šç‰©ä½“éƒ¨ä»¶ã€è¯­ä¹‰
   â†“ éœ€è¦å¾®è°ƒ
```

### PyTorch ä»£ç 

```python
# æ–¹å¼1ï¼šå†»ç»“æ‰€æœ‰å±‚
for param in model.parameters():
    param.requires_grad = False

# åªè®­ç»ƒåˆ†ç±»å¤´
model.fc = nn.Linear(2048, num_classes)

# æ–¹å¼2ï¼šåˆ†å±‚å­¦ä¹ ç‡
optimizer = optim.Adam([
    {'params': model.layer1.parameters(), 'lr': 1e-5},   # æµ…å±‚å°å­¦ä¹ ç‡
    {'params': model.layer2.parameters(), 'lr': 5e-5},
    {'params': model.layer3.parameters(), 'lr': 1e-4},
    {'params': model.layer4.parameters(), 'lr': 5e-4},
    {'params': model.fc.parameters(), 'lr': 1e-3},       # åˆ†ç±»å¤´å¤§å­¦ä¹ ç‡
])
```

---

## Q15: æ·±åº¦å¯åˆ†ç¦»å·ç§¯ä¸ºä»€ä¹ˆèƒ½å‹ç¼©å‚æ•°ï¼Ÿ

> æ¥æºï¼š10_modern_efficient_architectures.ipynb

### æ ‡å‡†å·ç§¯ vs æ·±åº¦å¯åˆ†ç¦»å·ç§¯

**æ ‡å‡†å·ç§¯**ï¼š
```
è¾“å…¥ (C_in, H, W) â†’ [KÃ—KÃ—C_inÃ—C_out] â†’ è¾“å‡º (C_out, H, W)
å‚æ•°é‡ = KÂ² Ã— C_in Ã— C_out
```

**æ·±åº¦å¯åˆ†ç¦»å·ç§¯**ï¼š
```
è¾“å…¥ (C_in, H, W)
    â†“ Depthwise: KÃ—KÃ—1 å·ç§¯ï¼Œæ¯ä¸ªé€šé“å•ç‹¬å¤„ç†
(C_in, H, W)
    â†“ Pointwise: 1Ã—1Ã—C_inÃ—C_out å·ç§¯
è¾“å‡º (C_out, H, W)

å‚æ•°é‡ = KÂ² Ã— C_in + C_in Ã— C_out
```

### å‹ç¼©æ¯”è®¡ç®—

$$\text{å‹ç¼©æ¯”} = \frac{K^2 \cdot C_{in} + C_{in} \cdot C_{out}}{K^2 \cdot C_{in} \cdot C_{out}} = \frac{1}{C_{out}} + \frac{1}{K^2}$$

å½“ K=3, C_out=256ï¼š
$$\text{å‹ç¼©æ¯”} \approx \frac{1}{9} \approx 11\%$$

**å‚æ•°å‡å°‘çº¦ 9 å€ï¼**

### PyTorch ä»£ç 

```python
# Depthwise: groups = C_in
nn.Conv2d(C_in, C_in, 3, padding=1, groups=C_in)

# Pointwise: 1Ã—1 å·ç§¯
nn.Conv2d(C_in, C_out, 1)
```

---

## Q16: MobileNet å€’æ®‹å·®å—æ˜¯ä»€ä¹ˆï¼Ÿ

> æ¥æºï¼š10_modern_efficient_architectures.ipynb

### ä¼ ç»Ÿæ®‹å·® vs å€’æ®‹å·®

```
ä¼ ç»Ÿæ®‹å·®ï¼ˆResNetï¼‰ï¼š          å€’æ®‹å·®ï¼ˆMobileNet V2ï¼‰ï¼š
  å®½ â†’ çª„ â†’ å®½                  çª„ â†’ å®½ â†’ çª„

è¾“å…¥ (256)                    è¾“å…¥ (24)
    â†“                             â†“
1Ã—1 é™ç»´ â†’ 64                 1Ã—1 å‡ç»´ â†’ 144 (Ã—6 æ‰©å±•)
    â†“                             â†“
3Ã—3 å·ç§¯                      3Ã—3 Depthwise
    â†“                             â†“
1Ã—1 å‡ç»´ â†’ 256                1Ã—1 é™ç»´ â†’ 24 (æ—  ReLU!)
    â†“                             â†“
(+) æ®‹å·®                      (+) æ®‹å·®
```

### ä¸ºä»€ä¹ˆã€Œå€’ã€è¿‡æ¥ï¼Ÿ

1. **é«˜ç»´ç©ºé—´åš Depthwise**ï¼šä¿¡æ¯æŸå¤±å°
2. **Linear Bottleneck**ï¼šæœ€åä¸€å±‚ä¸åŠ æ¿€æ´»ï¼Œé¿å… ReLU ç ´åä¿¡æ¯
3. **å‚æ•°æ•ˆç‡**ï¼šDepthwise å‚æ•°ä¸éšé€šé“æ•°å¢åŠ 

### å¯è§†åŒ–

```
ä¼ ç»Ÿï¼ˆæ²™æ¼ï¼‰:     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
                    â–ˆâ–ˆâ–ˆ
                  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

å€’æ®‹å·®ï¼ˆè±å½¢ï¼‰:     â–ˆâ–ˆâ–ˆ
                 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
                    â–ˆâ–ˆâ–ˆ
```

---

## Q17: SE-Net é€šé“æ³¨æ„åŠ›å¦‚ä½•å·¥ä½œï¼Ÿ

> æ¥æºï¼š11_attention_mechanisms.ipynb

### æ ¸å¿ƒæ€æƒ³

è®©ç½‘ç»œå­¦ä¹ ã€Œå…³æ³¨å“ªäº›é€šé“æ›´é‡è¦ã€ã€‚

### ä¸‰æ­¥è¿‡ç¨‹

```
è¾“å…¥ (C, H, W)
    â†“
1. Squeezeï¼šå…¨å±€å¹³å‡æ± åŒ– â†’ (C, 1, 1)
    â†“
2. Excitationï¼šFC â†’ ReLU â†’ FC â†’ Sigmoid â†’ (C, 1, 1)
    â†“
3. Scaleï¼šé€šé“åŠ æƒ Ã— åŸç‰¹å¾ â†’ (C, H, W)
```

### å¯è§†åŒ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¾“å…¥ (C, H, W)                     â”‚
â”‚      â†“                             â”‚
â”‚ GlobalAvgPool â†’ (C,)               â”‚ â† Squeeze
â”‚      â†“                             â”‚
â”‚ FC(C, C/r) â†’ ReLU â†’ FC(C/r, C)    â”‚ â† Excitation
â”‚      â†“                             â”‚
â”‚ Sigmoid â†’ é€šé“æƒé‡ (C,)            â”‚
â”‚      â†“                             â”‚
â”‚ è¾“å…¥ Ã— æƒé‡ â†’ è¾“å‡º                 â”‚ â† Scale
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### PyTorch ä»£ç 

```python
class SEBlock(nn.Module):
    def __init__(self, channels, r=16):
        super().__init__()
        self.squeeze = nn.AdaptiveAvgPool2d(1)
        self.excitation = nn.Sequential(
            nn.Linear(channels, channels // r),
            nn.ReLU(),
            nn.Linear(channels // r, channels),
            nn.Sigmoid()
        )

    def forward(self, x):
        b, c, _, _ = x.size()
        z = self.squeeze(x).view(b, c)        # Squeeze
        s = self.excitation(z).view(b, c, 1, 1)  # Excitation
        return x * s                           # Scale
```

---

## Q18: ä»€ä¹ˆæ˜¯ IoU å’Œ NMSï¼Ÿ

> æ¥æºï¼š12_detection_segmentation_intro.ipynb

### IoUï¼ˆäº¤å¹¶æ¯”ï¼‰

è¡¡é‡ä¸¤ä¸ªæ¡†çš„é‡å ç¨‹åº¦ã€‚

$$\text{IoU} = \frac{|A \cap B|}{|A \cup B|} = \frac{\text{äº¤é›†é¢ç§¯}}{\text{å¹¶é›†é¢ç§¯}}$$

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    A    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”
â”‚   â”‚ äº¤é›†â”‚ B â”‚
â””â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”˜   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

IoU = äº¤é›† / (A + B - äº¤é›†)
```

**é˜ˆå€¼åˆ¤æ–­**ï¼šIoU > 0.5 é€šå¸¸è®¤ä¸ºæ£€æµ‹æ­£ç¡®

### NMSï¼ˆéæå¤§å€¼æŠ‘åˆ¶ï¼‰

å»é™¤é‡å¤æ£€æµ‹æ¡†ã€‚

**ç®—æ³•æ­¥éª¤**ï¼š
```
1. æŒ‰ç½®ä¿¡åº¦æ’åºæ‰€æœ‰æ¡†
2. é€‰æ‹©æœ€é«˜åˆ†çš„æ¡†ï¼ŒåŠ å…¥ç»“æœ
3. åˆ é™¤ä¸å®ƒ IoU > é˜ˆå€¼çš„æ‰€æœ‰æ¡†
4. é‡å¤ 2-3ï¼Œç›´åˆ°æ²¡æœ‰æ¡†
```

### Python ä»£ç 

```python
def nms(boxes, scores, threshold=0.5):
    indices = scores.argsort()[::-1]  # æŒ‰åˆ†æ•°é™åºæ’åˆ—
    keep = []

    while len(indices) > 0:
        i = indices[0]
        keep.append(i)

        # è®¡ç®—ä¸å…¶ä»–æ¡†çš„ IoU
        ious = [calculate_iou(boxes[i], boxes[j]) for j in indices[1:]]

        # ä¿ç•™ IoU < é˜ˆå€¼çš„æ¡†
        indices = indices[1:][np.array(ious) < threshold]

    return keep
```

### å¯è§†åŒ–

```
NMS å‰ï¼šå¤šä¸ªé‡å æ¡†             NMS åï¼šä¿ç•™æœ€ä½³æ¡†
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”                â”‚           â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”¼â”€â”              â”‚   ğŸ±      â”‚
â”‚ â”‚ â”‚  ğŸ±   â”‚ â”‚ â”‚      â†’       â”‚           â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”¼â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## é™„å½•ï¼šå®Œæ•´æ¶æ„å¯è§†åŒ–

```
SimpleCNN_Numpy æ¶æ„:

è¾“å…¥ (1, 28, 28)
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Conv1: (8, 1, 3, 3)    â”‚  â† 8ä¸ªæ»¤æ³¢å™¨ï¼Œæ¯ä¸ªå¤„ç†1ä¸ªé€šé“
â”‚  He init: sqrt(2/9)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼ ReLU â†’ MaxPool(2Ã—2)

(8, 14, 14)
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Conv2: (16, 8, 3, 3)   â”‚  â† 16ä¸ªæ»¤æ³¢å™¨ï¼Œæ¯ä¸ªå¤„ç†8ä¸ªé€šé“
â”‚  He init: sqrt(2/72)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼ ReLU â†’ MaxPool(2Ã—2) â†’ Flatten

(784,)
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FC1: (784, 64)         â”‚
â”‚  He init: sqrt(2/784)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼ ReLU

(64,)
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FC2: (64, 10)          â”‚  â† 10ç±»è¾“å‡º
â”‚  He init: sqrt(2/64)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
è¾“å‡º (10,) â†’ åˆ†ç±» logits
```

---

## å‚è€ƒèµ„æ–™

- [He et al., 2015] Delving Deep into Rectifiersï¼ˆHe åˆå§‹åŒ–ï¼‰
- [Simonyan & Zisserman, 2014] VGGNetï¼ˆ3Ã—3 å·ç§¯ï¼‰
- [He et al., 2016] Deep Residual Learningï¼ˆResNetï¼‰
- [Howard et al., 2017] MobileNetsï¼ˆæ·±åº¦å¯åˆ†ç¦»å·ç§¯ï¼‰
- [Sandler et al., 2018] MobileNet V2ï¼ˆå€’æ®‹å·®å—ï¼‰
- [Hu et al., 2018] SE-Netï¼ˆé€šé“æ³¨æ„åŠ›ï¼‰
- [Tan & Le, 2019] EfficientNetï¼ˆå¤åˆç¼©æ”¾ï¼‰

---

*æœ€åæ›´æ–°ï¼š2025-01*
*è¦†ç›– 4.1_cnn ç›®å½•å…¨éƒ¨ 14 ä¸ªæ•™ç¨‹*
