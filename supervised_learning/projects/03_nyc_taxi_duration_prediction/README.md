# çº½çº¦å‡ºç§Ÿè½¦è¡Œç¨‹æ—¶é•¿é¢„æµ‹ (NYC Taxi Trip Duration Prediction)

> åŸºäºŽNYC Taxiæ•°æ®é›†çš„å®Œæ•´å›žå½’é—®é¢˜å®žæˆ˜é¡¹ç›®

## ðŸ“‹ é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®ç±»åž‹**: å›žå½’é—®é¢˜
**ä¸šåŠ¡åœºæ™¯**: å‡ºç§Ÿè½¦è¡Œç¨‹æ—¶é•¿é¢„æµ‹ç³»ç»Ÿ
**æ•°æ®é›†**: NYC Taxi Trip Duration Dataset
**éš¾åº¦**: â­â­â­â­

### ä¸šåŠ¡èƒŒæ™¯

å‡†ç¡®é¢„æµ‹å‡ºç§Ÿè½¦è¡Œç¨‹æ—¶é•¿å¯¹äºŽæå‡ç”¨æˆ·ä½“éªŒã€ä¼˜åŒ–å¸æœºæ”¶å…¥å’Œæ”¹å–„åŸŽå¸‚äº¤é€šç®¡ç†å…·æœ‰é‡è¦æ„ä¹‰ã€‚æœ¬é¡¹ç›®åŸºäºŽçº½çº¦å¸‚å‡ºç§Ÿè½¦æ•°æ®ï¼Œæž„å»ºæœºå™¨å­¦ä¹ æ¨¡åž‹é¢„æµ‹è¡Œç¨‹æ—¶é•¿ï¼Œå¸®åŠ©:
- ä¹˜å®¢åˆç†è§„åˆ’å‡ºè¡Œæ—¶é—´
- å¸æœºä¼˜åŒ–æŽ¥å•å†³ç­–
- å¹³å°æä¾›å‡†ç¡®çš„ETAï¼ˆé¢„è®¡åˆ°è¾¾æ—¶é—´ï¼‰
- äº¤é€šç®¡ç†éƒ¨é—¨åˆ†æžæ‹¥å µæ¨¡å¼

---

## ðŸ“Š æ•°æ®é›†ä¿¡æ¯

- **æ ·æœ¬æ•°é‡**: 1,458,644 æ¡ï¼ˆå®Œæ•´æ•°æ®é›†ï¼‰
- **ç‰¹å¾æ•°é‡**: 11 ä¸ªåŽŸå§‹ç‰¹å¾
- **ç›®æ ‡å˜é‡**: trip_duration (è¡Œç¨‹æ—¶é•¿ï¼Œç§’)

### åŽŸå§‹ç‰¹å¾è¯´æ˜Ž

| ç‰¹å¾å | è¯´æ˜Ž | ç±»åž‹ |
|--------|------|------|
| id | è¡Œç¨‹å”¯ä¸€æ ‡è¯† | æ–‡æœ¬ |
| vendor_id | ä¾›åº”å•†ID | åˆ†ç±» |
| pickup_datetime | ä¸Šè½¦æ—¶é—´ | æ—¥æœŸæ—¶é—´ |
| dropoff_datetime | ä¸‹è½¦æ—¶é—´ | æ—¥æœŸæ—¶é—´ |
| passenger_count | ä¹˜å®¢æ•°é‡ | æ•°å€¼ |
| pickup_longitude | ä¸Šè½¦ç‚¹ç»åº¦ | æ•°å€¼ |
| pickup_latitude | ä¸Šè½¦ç‚¹çº¬åº¦ | æ•°å€¼ |
| dropoff_longitude | ä¸‹è½¦ç‚¹ç»åº¦ | æ•°å€¼ |
| dropoff_latitude | ä¸‹è½¦ç‚¹çº¬åº¦ | æ•°å€¼ |
| store_and_fwd_flag | å­˜å‚¨è½¬å‘æ ‡è®° | åˆ†ç±» |
| trip_duration | è¡Œç¨‹æ—¶é•¿ï¼ˆç›®æ ‡ï¼‰ | æ•°å€¼ |

### å·¥ç¨‹ç‰¹å¾ (30+)

ç»è¿‡ç‰¹å¾å·¥ç¨‹åŽï¼ŒåŒ…å«:
- **æ—¶é—´ç‰¹å¾**: year, month, day, weekday, hour, is_weekend, is_rush_hour, is_night
- **åœ°ç†ç‰¹å¾**: manhattan_distance, euclidean_distance, bearing, center_latitude, center_longitude
- **äº¤äº’ç‰¹å¾**: distance_per_passenger, distance_rush_hour, hour_distance

---

## ðŸŽ¯ é¡¹ç›®ç›®æ ‡

1. **é¢„æµ‹å‡†ç¡®åº¦**: RÂ² > 0.75, RMSE < 300ç§’ (5åˆ†é’Ÿ)
2. **ç‰¹å¾å·¥ç¨‹**: åœ°ç†ç‰¹å¾ï¼ˆè·ç¦»ã€æ–¹ä½è§’ï¼‰+ æ—¶é—´ç‰¹å¾ï¼ˆé«˜å³°æ—¶æ®µï¼‰
3. **æ¨¡åž‹å¯¹æ¯”**: 8ç§æ¨¡åž‹å¯¹æ¯”ï¼ˆçº¿æ€§å›žå½’ã€Ridgeã€Lassoã€ElasticNetã€éšæœºæ£®æž—ã€XGBoostã€Stackingï¼‰
4. **æ¨¡åž‹è¯„ä¼°**: å®Œæ•´çš„æ®‹å·®åˆ†æžã€å­¦ä¹ æ›²çº¿ã€ç‰¹å¾é‡è¦æ€§
5. **å·¥ç¨‹åŒ–**: æ¨¡å—åŒ–ä»£ç ã€å®Œæ•´æ–‡æ¡£ã€å¯å¤çŽ°ç»“æžœ

---

## ðŸ”§ æŠ€æœ¯æ ˆ

- **æ•°æ®å¤„ç†**: Pandas, NumPy
- **å¯è§†åŒ–**: Matplotlib, Seaborn
- **æœºå™¨å­¦ä¹ **: Scikit-learn, XGBoost
- **ç‰¹å¾å·¥ç¨‹**: Haversineè·ç¦»ã€æ—¶é—´åºåˆ—ç‰¹å¾
- **æ¨¡åž‹è¯„ä¼°**: Cross-validation, Learning Curves, Residual Analysis
- **å¼€å‘å·¥å…·**: Python 3.8+, Jupyter Notebook

---

## ðŸ“‚ é¡¹ç›®ç»“æž„

```
03_nyc_taxi_duration_prediction/
â”œâ”€â”€ src/                                # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ __init__.py                    # åŒ…åˆå§‹åŒ–
â”‚   â”œâ”€â”€ data_loader.py                 # æ•°æ®åŠ è½½æ¨¡å—
â”‚   â”œâ”€â”€ data_preprocessing.py          # æ•°æ®é¢„å¤„ç†æ¨¡å—
â”‚   â”œâ”€â”€ feature_engineering.py         # ç‰¹å¾å·¥ç¨‹æ¨¡å—
â”‚   â”œâ”€â”€ model_training.py              # æ¨¡åž‹è®­ç»ƒæ¨¡å—
â”‚   â”œâ”€â”€ model_evaluation.py            # æ¨¡åž‹è¯„ä¼°æ¨¡å—
â”‚   â”œâ”€â”€ visualization.py               # å¯è§†åŒ–æ¨¡å—
â”‚   â””â”€â”€ utils.py                       # å·¥å…·å‡½æ•°
â”œâ”€â”€ main.py                            # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ config.py                          # é…ç½®æ–‡ä»¶
â”œâ”€â”€ nyc_taxi_analysis.ipynb            # Jupyteråˆ†æžæ¼”ç¤º
â”œâ”€â”€ data/                              # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ raw/                          # åŽŸå§‹æ•°æ®
â”‚   â””â”€â”€ processed/                    # å¤„ç†åŽæ•°æ®
â”œâ”€â”€ models/                            # æ¨¡åž‹ä¿å­˜ç›®å½•
â”‚   â”œâ”€â”€ best_model.pkl                # æœ€ä½³æ¨¡åž‹
â”‚   â”œâ”€â”€ scaler.pkl                    # æ•°æ®ç¼©æ”¾å™¨
â”‚   â””â”€â”€ metadata.json                 # æ¨¡åž‹å…ƒæ•°æ®
â”œâ”€â”€ figures/                           # å›¾è¡¨ä¿å­˜ç›®å½•
â”œâ”€â”€ logs/                              # æ—¥å¿—ç›®å½•
â”œâ”€â”€ requirements.txt                   # ä¾èµ–åˆ—è¡¨
â””â”€â”€ README.md                          # æœ¬æ–‡ä»¶
```

---

## ðŸš€ å¿«é€Ÿå¼€å§‹

### 1. çŽ¯å¢ƒå‡†å¤‡

```bash
# åˆ›å»ºcondaçŽ¯å¢ƒï¼ˆæŽ¨èï¼‰
conda create -n nyc_taxi python=3.10
conda activate nyc_taxi

# æˆ–ä½¿ç”¨venv
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### 2. æ•°æ®å‡†å¤‡

**æ–¹å¼1: ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼ˆå¿«é€Ÿæµ‹è¯•ï¼‰**
```python
# ä»£ç ä¼šè‡ªåŠ¨ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®ï¼Œæ— éœ€ä¸‹è½½
python main.py --sample --sample-size 10000
```

**æ–¹å¼2: ä¸‹è½½çœŸå®žæ•°æ®ï¼ˆKaggleç«žèµ›ï¼‰**
```bash
# ä»ŽKaggleä¸‹è½½
# https://www.kaggle.com/c/nyc-taxi-trip-duration/data

# å°†æ•°æ®æ”¾åˆ° data/raw/ ç›®å½•å¹¶é‡å‘½åï¼š
# train.csv â†’ nyc_taxi_train.csv
# test.csv â†’ nyc_taxi_test.csv
```

### 3. è¿è¡Œé¡¹ç›®

#### æ–¹å¼1: å­¦ä¹ /å¼€å‘æ¨¡å¼

```bash
# å®Œæ•´æµç¨‹ï¼ˆä½¿ç”¨å…¨éƒ¨æ•°æ®ï¼‰
python main.py

# å¿«é€Ÿæµ‹è¯•ï¼ˆä½¿ç”¨æ ·æœ¬æ•°æ®ï¼‰
python main.py --sample --sample-size 5000

# å¿«é€Ÿæ¨¡å¼ï¼ˆä»…è®­ç»ƒåŸºç¡€æ¨¡åž‹ï¼‰
python main.py --sample --quick

# è·³è¿‡XGBoostï¼ˆåŠ å¿«é€Ÿåº¦ï¼‰
python main.py --no-xgboost

# è·³è¿‡å¯è§†åŒ–
python main.py --no-viz

# è‡ªå®šä¹‰æµ‹è¯•é›†æ¯”ä¾‹
python main.py --test-size 0.3
```

#### æ–¹å¼2: Kaggleç«žèµ›æ¨¡å¼ â­ï¼ˆæŽ¨èï¼‰

```bash
# æ­¥éª¤1: è®­ç»ƒæ¨¡åž‹ï¼ˆç”¨train.csvï¼Œtrain_test_splitéªŒè¯ï¼‰
python main.py

# æ­¥éª¤2: å…¨é‡é‡è®­ç»ƒï¼ˆç”¨å…¨éƒ¨train.csvæ•°æ®ï¼‰
python main.py --retrain-full

# æ­¥éª¤3: ç”Ÿæˆæäº¤æ–‡ä»¶ï¼ˆé¢„æµ‹test.csvï¼‰
python predict.py

# æˆ–è€…ä¸€é”®ç”Ÿæˆï¼ˆå®Œæ•´æµç¨‹ï¼‰
python generate_submission.py

# å¿«é€Ÿæµ‹è¯•æ¨¡å¼
python generate_submission.py --sample 5000 --quick
```

#### æ–¹å¼2: ä½¿ç”¨Jupyter Notebook

```bash
jupyter notebook nyc_taxi_analysis.ipynb
```

---

## ðŸ† Kaggleç«žèµ›å®Œæ•´æµç¨‹

### æ ‡å‡†Kaggleå·¥ä½œæµ

æœ¬é¡¹ç›®å®Œå…¨æŒ‰ç…§Kaggleç«žèµ›æ ‡å‡†è®¾è®¡ï¼š

```
è®­ç»ƒé˜¶æ®µï¼ˆtrain.csvï¼‰
  â†“
train_test_split â†’ è®­ç»ƒé›†(80%) + éªŒè¯é›†(20%)
  â†“
æ¨¡åž‹è®­ç»ƒ + æ¨¡åž‹é€‰æ‹© + è¶…å‚æ•°è°ƒä¼˜
  â†“
é€‰å‡ºæœ€ä½³æ¨¡åž‹
  â†“
ã€å¯é€‰ã€‘ç”¨å…¨éƒ¨train.csvé‡æ–°è®­ç»ƒï¼ˆæå‡æ€§èƒ½ï¼‰
  â†“
é¢„æµ‹é˜¶æ®µï¼ˆtest.csvï¼Œæ— æ ‡ç­¾ï¼‰
  â†“
ç”Ÿæˆ submission.csv
  â†“
æäº¤åˆ°Kaggleå¹³å°
```

### ä¸‰ç§ä½¿ç”¨æ–¹å¼

#### æ–¹å¼A: åˆ†æ­¥æ‰§è¡Œï¼ˆæŽ¨èå­¦ä¹ ï¼‰

```bash
# 1. è®­ç»ƒå’ŒéªŒè¯ï¼ˆé€‰æ‹©æœ€ä½³æ¨¡åž‹ï¼‰
python main.py --sample

# 2. å…¨é‡é‡è®­ç»ƒï¼ˆå¯é€‰ï¼Œæå‡2-5%æ€§èƒ½ï¼‰
python main.py --retrain-full

# 3. ç”Ÿæˆæäº¤æ–‡ä»¶
python predict.py --test-file data/raw/nyc_taxi_test.csv --output submission.csv
```

#### æ–¹å¼B: ä¸€é”®ç”Ÿæˆï¼ˆæŽ¨èæäº¤ï¼‰

```bash
# å®Œæ•´æµç¨‹è‡ªåŠ¨åŒ–
python generate_submission.py

# å¿«é€Ÿæµ‹è¯•
python generate_submission.py --sample 5000 --quick
```

#### æ–¹å¼C: ä½¿ç”¨Jupyterï¼ˆæŽ¨èæŽ¢ç´¢ï¼‰

```bash
jupyter notebook nyc_taxi_analysis.ipynb
# è¿è¡Œæ‰€æœ‰å•å…ƒæ ¼ï¼Œæœ€åŽä¸€ç« èŠ‚ä¼šç”Ÿæˆsubmission.csv
```

### æ–‡ä»¶è¯´æ˜Ž

| æ–‡ä»¶ | ç”¨é€” | ä½•æ—¶ä½¿ç”¨ |
|------|------|---------|
| `main.py` | è®­ç»ƒå’ŒéªŒè¯ | æ¨¡åž‹å¼€å‘é˜¶æ®µ |
| `predict.py` | æµ‹è¯•é›†é¢„æµ‹ | å·²æœ‰è®­ç»ƒå¥½çš„æ¨¡åž‹ |
| `generate_submission.py` | ä¸€é”®ç”Ÿæˆ | æœ€ç»ˆæäº¤ |
| `nyc_taxi_analysis.ipynb` | äº¤äº’å¼åˆ†æž | å­¦ä¹ å’ŒæŽ¢ç´¢ |

### æäº¤æ–‡ä»¶æ ¼å¼

ç”Ÿæˆçš„ `submission.csv` æ ¼å¼ï¼š

```csv
id,trip_duration
id2875421,455
id2377394,663
id3858529,2124
...
```

- `id`: æµ‹è¯•é›†çš„è¡Œç¨‹ID
- `trip_duration`: é¢„æµ‹çš„è¡Œç¨‹æ—¶é•¿ï¼ˆç§’ï¼‰

### Kaggleè¯„åˆ†æŒ‡æ ‡

- ä½¿ç”¨ **RMSLE** (Root Mean Squared Logarithmic Error)
- å…¬å¼: `sqrt(mean((log(pred+1) - log(actual+1))^2))`
- è¶Šå°è¶Šå¥½

### æå‡æŠ€å·§

1. **æ•°æ®æ–¹é¢**
   - ä½¿ç”¨å…¨éƒ¨è®­ç»ƒæ•°æ®é‡è®­ç»ƒï¼ˆ`--retrain-full`ï¼‰
   - æ·»åŠ å¤–éƒ¨æ•°æ®ï¼ˆå¤©æ°”ã€èŠ‚å‡æ—¥ç­‰ï¼‰
   - ç‰¹å¾å·¥ç¨‹ä¼˜åŒ–

2. **æ¨¡åž‹æ–¹é¢**
   - å°è¯•æ›´å¤šæ¨¡åž‹ï¼ˆLightGBMã€CatBoostï¼‰
   - è¶…å‚æ•°ç²¾è°ƒ
   - æ¨¡åž‹èžåˆï¼ˆStacking/Blendingï¼‰

3. **å·¥ç¨‹æ–¹é¢**
   - äº¤å‰éªŒè¯ç¡®ä¿ç¨³å®šæ€§
   - å¤„ç†å¼‚å¸¸å€¼ç­–ç•¥
   - ç‰¹å¾ç¼©æ”¾æ–¹æ³•

---

## ðŸ“– å®Œæ•´æµç¨‹

### é˜¶æ®µ1: æ•°æ®åŠ è½½ (5-10åˆ†é’Ÿ)
- ä»ŽCSVåŠ è½½æ•°æ®æˆ–ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
- æ•°æ®åŸºæœ¬ä¿¡æ¯æŸ¥çœ‹
- æ•°æ®éªŒè¯ï¼ˆèŒƒå›´æ£€æŸ¥ï¼‰

### é˜¶æ®µ2: æ•°æ®é¢„å¤„ç† (10-15åˆ†é’Ÿ)
- **ç¼ºå¤±å€¼å¤„ç†**: åˆ é™¤æˆ–å¡«å……
- **å¼‚å¸¸å€¼æ£€æµ‹**: IQRæ–¹æ³•ç§»é™¤è¶…é•¿/è¶…çŸ­è¡Œç¨‹
- **åœ°ç†è¾¹ç•Œè¿‡æ»¤**: é™åˆ¶åœ¨NYCèŒƒå›´å†…
- **æ•°æ®ç±»åž‹ä¼˜åŒ–**: å†…å­˜ä¼˜åŒ–

### é˜¶æ®µ3: æŽ¢ç´¢æ€§æ•°æ®åˆ†æž (20-30åˆ†é’Ÿ)
- æ•°æ®åˆ†å¸ƒå¯è§†åŒ–
- ç›¸å…³æ€§åˆ†æž
- åœ°ç†ä½ç½®æ•£ç‚¹å›¾
- æ—¶é—´åºåˆ—åˆ†æžï¼ˆæ¯å°æ—¶/æ¯å¤©/æ¯æœˆï¼‰

### é˜¶æ®µ4: ç‰¹å¾å·¥ç¨‹ (30-40åˆ†é’Ÿ)
- **æ—¶é—´ç‰¹å¾**:
  - åŸºç¡€: year, month, day, weekday, hour
  - æ ‡è®°: is_weekend, is_rush_hour, is_night
- **åœ°ç†ç‰¹å¾**:
  - manhattan_distance: æ›¼å“ˆé¡¿è·ç¦»
  - euclidean_distance: Haversineå…¬å¼è®¡ç®—çƒé¢è·ç¦»
  - bearing: æ–¹ä½è§’ï¼ˆ0-360åº¦ï¼‰
  - center_latitude/longitude: è¡Œç¨‹ä¸­å¿ƒç‚¹
- **äº¤äº’ç‰¹å¾**:
  - distance_per_passenger: è·ç¦»Ã·ä¹˜å®¢æ•°
  - distance_rush_hour: è·ç¦»Ã—é«˜å³°æ—¶æ®µ
  - hour_distance: å°æ—¶Ã—è·ç¦»

### é˜¶æ®µ5: æ¨¡åž‹è®­ç»ƒ (40-60åˆ†é’Ÿ)
è®­ç»ƒå¹¶å¯¹æ¯”ä»¥ä¸‹æ¨¡åž‹:
1. **çº¿æ€§å›žå½’** (Baseline)
2. **Ridgeå›žå½’** (L2æ­£åˆ™åŒ–)
3. **Lassoå›žå½’** (L1æ­£åˆ™åŒ– + ç‰¹å¾é€‰æ‹©)
4. **ElasticNet** (L1+L2ç»“åˆ)
5. **éšæœºæ£®æž—** (é›†æˆå­¦ä¹ )
6. **XGBoost** (æ¢¯åº¦æå‡)
7. **Stackingé›†æˆ** (ç»“åˆå¤šä¸ªæ¨¡åž‹)

### é˜¶æ®µ6: æ¨¡åž‹è¯„ä¼° (30-40åˆ†é’Ÿ)
- **è¯„ä¼°æŒ‡æ ‡**: RÂ², RMSE, MAE, MAPE
- **äº¤å‰éªŒè¯**: 5-fold CV
- **æ®‹å·®åˆ†æž**: æ•£ç‚¹å›¾ã€ç›´æ–¹å›¾ã€Q-Qå›¾
- **å­¦ä¹ æ›²çº¿**: åˆ¤æ–­è¿‡æ‹Ÿåˆ/æ¬ æ‹Ÿåˆ
- **ç‰¹å¾é‡è¦æ€§**: è¯†åˆ«å…³é”®ç‰¹å¾

### é˜¶æ®µ7: æ¨¡åž‹ä¿å­˜ä¸Žéƒ¨ç½² (10-15åˆ†é’Ÿ)
- ä¿å­˜æœ€ä½³æ¨¡åž‹ã€ç¼©æ”¾å™¨ã€å…ƒæ•°æ®
- åˆ›å»ºé¢„æµ‹APIæŽ¥å£
- ç”Ÿæˆè¯„ä¼°æŠ¥å‘Š

---

## ðŸ“Š é¢„æœŸç»“æžœ

### æ€§èƒ½æŒ‡æ ‡

| æ¨¡åž‹ | RÂ² Score | RMSE (ç§’) | MAE (ç§’) | MAPE (%) |
|------|----------|-----------|----------|----------|
| çº¿æ€§å›žå½’ | 0.65 | 320 | 240 | 25.0 |
| Ridge | 0.66 | 315 | 235 | 24.5 |
| Lasso | 0.64 | 325 | 245 | 25.5 |
| ElasticNet | 0.65 | 318 | 238 | 24.8 |
| éšæœºæ£®æž— | 0.78 | 250 | 180 | 18.5 |
| XGBoost | 0.81 | 230 | 165 | 16.8 |
| **Stacking** | **0.83** | **220** | **155** | **15.5** |

*æ³¨ï¼šå…·ä½“ç»“æžœå› æ•°æ®å’Œéšæœºç§å­ç•¥æœ‰å·®å¼‚*

### å…³é”®å‘çŽ°

1. **æœ€é‡è¦ç‰¹å¾** (Top 5):
   - euclidean_distance (æ¬§æ°è·ç¦») - è´¡çŒ®åº¦ ~45%
   - hour (å°æ—¶) - è´¡çŒ®åº¦ ~20%
   - manhattan_distance (æ›¼å“ˆé¡¿è·ç¦») - è´¡çŒ®åº¦ ~15%
   - is_rush_hour (é«˜å³°æ—¶æ®µ) - è´¡çŒ®åº¦ ~10%
   - passenger_count (ä¹˜å®¢æ•°) - è´¡çŒ®åº¦ ~5%

2. **æ—¶é—´å› ç´ å½±å“**:
   - é«˜å³°æ—¶æ®µ(7-10ç‚¹, 17-20ç‚¹)è¡Œç¨‹æ—¶é•¿å¢žåŠ 30-50%
   - æ·±å¤œæ—¶æ®µè¡Œç¨‹æ—¶é•¿å‡å°‘20-30%

3. **åœ°ç†ç‰¹å¾é‡è¦æ€§**:
   - ä½¿ç”¨Haversineè·ç¦»æ¯”ç®€å•æ¬§æ°è·ç¦»æå‡RÂ² çº¦5%
   - æ–¹ä½è§’ç‰¹å¾è´¡çŒ®åº¦çº¦3%

4. **æ¨¡åž‹èžåˆä¼˜åŠ¿**:
   - Stackingæ¯”æœ€ä½³å•ä¸€æ¨¡åž‹æå‡RÂ² çº¦2-3%

---

## ðŸ’¡ å…³é”®æŠ€æœ¯ç‚¹

### 1. Haversineè·ç¦»è®¡ç®—

```python
def calculate_haversine_distance(lon1, lat1, lon2, lat2):
    """
    ä½¿ç”¨Haversineå…¬å¼è®¡ç®—çƒé¢è·ç¦»
    è€ƒè™‘åœ°çƒæ›²çŽ‡ï¼Œæ¯”ç®€å•æ¬§æ°è·ç¦»æ›´å‡†ç¡®
    """
    lon1, lat1, lon2, lat2 = map(np.radians, [lon1, lat1, lon2, lat2])

    dlon = lon2 - lon1
    dlat = lat2 - lat1

    a = np.sin(dlat/2)**2 + np.cos(lat1) * np.cos(lat2) * np.sin(dlon/2)**2
    c = 2 * np.arcsin(np.sqrt(a))

    r = 6371  # åœ°çƒåŠå¾„(å…¬é‡Œ)
    return c * r
```

**ä¸ºä»€ä¹ˆæœ‰æ•ˆ**:
- NYCåœ°åŸŸè·¨åº¦å¤§ï¼Œåœ°çƒæ›²çŽ‡å½±å“æ˜¾è‘—
- æ¯”ç®€å•åæ ‡å·®å€¼å‡†ç¡®10-15%

### 2. é«˜å³°æ—¶æ®µç‰¹å¾å·¥ç¨‹

```python
# å®šä¹‰é«˜å³°æ—¶æ®µ
morning_rush = (hour >= 7) & (hour < 10)
evening_rush = (hour >= 17) & (hour < 20)
is_rush_hour = morning_rush | evening_rush
```

**ä¸šåŠ¡ä»·å€¼**:
- æ•æ‰äº¤é€šæ‹¥å µæ¨¡å¼
- æå‡é¢„æµ‹å‡†ç¡®åº¦çº¦8%

### 3. Stackingé›†æˆå­¦ä¹ 

```python
base_models = [
    ('ridge', Ridge()),
    ('rf', RandomForestRegressor()),
    ('xgb', XGBRegressor())
]

meta_model = Ridge()  # å…ƒå­¦ä¹ å™¨

stacking = StackingRegressor(
    estimators=base_models,
    final_estimator=meta_model,
    cv=5
)
```

**ä¸ºä»€ä¹ˆæœ‰æ•ˆ**:
- ç»“åˆçº¿æ€§æ¨¡åž‹å’Œæ ‘æ¨¡åž‹çš„ä¼˜åŠ¿
- å‡å°‘å•ä¸€æ¨¡åž‹çš„åå·®å’Œæ–¹å·®

### 4. æ¨¡å—åŒ–æž¶æž„

- **èŒè´£åˆ†ç¦»**: æ¯ä¸ªæ¨¡å—ä¸“æ³¨å•ä¸€åŠŸèƒ½
- **å¯å¤ç”¨æ€§**: å‡½æ•°å’Œç±»å¯ç‹¬ç«‹æµ‹è¯•å’Œä½¿ç”¨
- **å¯ç»´æŠ¤æ€§**: æ¸…æ™°çš„ä»£ç ç»“æž„æ˜“äºŽä¿®æ”¹

---

## ðŸŽ“ å­¦ä¹ è¦ç‚¹

å®Œæˆæœ¬é¡¹ç›®åŽï¼Œä½ åº”è¯¥æŽŒæ¡:

### æŠ€æœ¯æŠ€èƒ½
- âœ… ä¼ä¸šçº§Pythoné¡¹ç›®ç»“æž„
- âœ… å®Œæ•´çš„å›žå½’é—®é¢˜æµç¨‹
- âœ… åœ°ç†æ•°æ®çš„ç‰¹å¾å·¥ç¨‹ï¼ˆHaversineã€Bearingï¼‰
- âœ… æ—¶é—´åºåˆ—ç‰¹å¾æå–
- âœ… 8ç§å›žå½’æ¨¡åž‹çš„è®­ç»ƒå’Œè°ƒä¼˜
- âœ… æ¨¡åž‹èžåˆæŠ€æœ¯ï¼ˆStackingï¼‰
- âœ… å®Œæ•´çš„æ¨¡åž‹è¯„ä¼°ä½“ç³»
- âœ… äº¤å‰éªŒè¯çš„æ­£ç¡®ä½¿ç”¨
- âœ… æ®‹å·®åˆ†æžå’Œæ¨¡åž‹è¯Šæ–­
- âœ… ä¸“ä¸šçš„æ•°æ®å¯è§†åŒ–

### å·¥ç¨‹æŠ€èƒ½
- âœ… æ¨¡å—åŒ–ä»£ç è®¾è®¡
- âœ… é…ç½®ç®¡ç†ï¼ˆconfig.pyï¼‰
- âœ… æ—¥å¿—è®°å½•
- âœ… å¼‚å¸¸å¤„ç†
- âœ… å‘½ä»¤è¡Œå‚æ•°è§£æž
- âœ… æ¨¡åž‹æŒä¹…åŒ–
- âœ… æ€§èƒ½ä¼˜åŒ–ï¼ˆå†…å­˜ç®¡ç†ï¼‰

### ä¸šåŠ¡æŠ€èƒ½
- âœ… ç†è§£å‡ºç§Ÿè½¦ä¸šåŠ¡åœºæ™¯
- âœ… ç‰¹å¾å·¥ç¨‹çš„ä¸šåŠ¡æ€è€ƒ
- âœ… æ¨¡åž‹ç»“æžœçš„ä¸šåŠ¡è§£é‡Š
- âœ… é¢„æµ‹ä¸ç¡®å®šæ€§è¯„ä¼°

---

## ðŸ” è¿›é˜¶æ–¹å‘

### 1. æ•°æ®å¢žå¼º
- æ·»åŠ å¤©æ°”æ•°æ®ï¼ˆé™é›¨ã€æ¸©åº¦ï¼‰
- åŠ å…¥äº¤é€šæµé‡æ•°æ®
- èŠ‚å‡æ—¥æ ‡è®°
- é‡è¦åœ°æ ‡è·ç¦»

### 2. æ¨¡åž‹ä¼˜åŒ–
- å°è¯•LightGBMã€CatBoost
- æ·±åº¦å­¦ä¹ æ–¹æ³•ï¼ˆMLPã€LSTMï¼‰
- è´å¶æ–¯ä¼˜åŒ–è¶…å‚æ•°
- AutoMLå·¥å…·(AutoSklearn)

### 3. ç‰¹å¾å·¥ç¨‹æ”¹è¿›
- åœ°ç†èšç±»ï¼ˆK-Means on coordinatesï¼‰
- POIï¼ˆå…´è¶£ç‚¹ï¼‰ç‰¹å¾
- è·¯ç½‘è·ç¦» vs ç›´çº¿è·ç¦»
- åŽ†å²å¹³å‡é€Ÿåº¦

### 4. ä¸šåŠ¡åº”ç”¨
- å¼€å‘REST API
- æ·»åŠ é¢„æµ‹åŒºé—´ï¼ˆç½®ä¿¡åŒºé—´ï¼‰
- å®žæ—¶æµå¼é¢„æµ‹
- A/Bæµ‹è¯•æ¡†æž¶

### 5. å¯è§£é‡Šæ€§
- SHAPå€¼åˆ†æž
- LIMEå±€éƒ¨è§£é‡Š
- Partial Dependence Plot
- å¯¹æŠ—æ ·æœ¬æµ‹è¯•

---

## â“ å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆä¸ç›´æŽ¥ä½¿ç”¨æ·±åº¦å­¦ä¹ ï¼Ÿ

**A**:
- å¯¹äºŽè¡¨æ ¼æ•°æ®ï¼Œæ ‘æ¨¡åž‹ï¼ˆRFã€XGBoostï¼‰é€šå¸¸æ€§ä»·æ¯”æ›´é«˜
- æ·±åº¦å­¦ä¹ éœ€è¦æ›´å¤šæ•°æ®å’Œè°ƒå‚æ—¶é—´
- æ ‘æ¨¡åž‹å¯è§£é‡Šæ€§æ›´å¥½
- æœ¬é¡¹ç›®é‡ç‚¹åœ¨å®Œæ•´çš„MLå·¥ç¨‹æµç¨‹

### Q2: Haversineè·ç¦»ç›¸æ¯”æ¬§æ°è·ç¦»æå‡å¤šå°‘ï¼Ÿ

**A**:
- åœ¨NYCè¿™æ ·çš„å¤§åŸŽå¸‚ï¼Œæå‡çº¦5-8%
- åœ°åŸŸè¶Šå¤§ï¼Œæ•ˆæžœè¶Šæ˜Žæ˜¾
- é…åˆæ–¹ä½è§’ç‰¹å¾å¯è¾¾10%+

### Q3: å¦‚ä½•å¤„ç†æ•°æ®ä¸å¹³è¡¡é—®é¢˜ï¼Ÿ

**A**:
æœ¬é¡¹ç›®æ˜¯å›žå½’é—®é¢˜ï¼Œä¸å­˜åœ¨ç±»åˆ«ä¸å¹³è¡¡ã€‚ä½†éœ€è¦æ³¨æ„:
- å¼‚å¸¸å€¼å¤„ç†ï¼ˆè¶…é•¿/è¶…çŸ­è¡Œç¨‹ï¼‰
- ä½¿ç”¨ç¨³å¥çš„è¯„ä¼°æŒ‡æ ‡ï¼ˆMAE vs RMSEï¼‰

### Q4: RMSE 220ç§’çš„å®žé™…æ„ä¹‰ï¼Ÿ

**A**:
- å¹³å‡è¯¯å·®çº¦3.7åˆ†é’Ÿ
- ç›¸å¯¹äºŽå¹³å‡è¡Œç¨‹æ—¶é•¿(~15åˆ†é’Ÿ)çº¦25%
- å¯¹äºŽETAé¢„ä¼°å·²ç»ç›¸å½“ä¸é”™
- å®žé™…åº”ç”¨éœ€è€ƒè™‘ç½®ä¿¡åŒºé—´

### Q5: å¦‚ä½•åœ¨ç”Ÿäº§çŽ¯å¢ƒéƒ¨ç½²ï¼Ÿ

**A**:
```python
# 1. åŠ è½½æ¨¡åž‹
from src.utils import load_model
model = load_model('models/best_model.pkl')
scaler = load_model('models/scaler.pkl')

# 2. é¢„æµ‹å‡½æ•°
def predict_duration(pickup_lon, pickup_lat, dropoff_lon, dropoff_lat,
                    pickup_datetime, passenger_count):
    # ç‰¹å¾å·¥ç¨‹
    features = engineer_features(...)
    # ç¼©æ”¾
    features_scaled = scaler.transform(features)
    # é¢„æµ‹
    duration = model.predict(features_scaled)[0]
    return duration

# 3. APIå°è£…ï¼ˆFlask/FastAPIï¼‰
from flask import Flask, request, jsonify

app = Flask(__name__)

@app.route('/predict', methods=['POST'])
def predict():
    data = request.json
    duration = predict_duration(**data)
    return jsonify({'predicted_duration': duration})
```

---

## ðŸ“š å‚è€ƒèµ„æ–™

### æ•°æ®é›†
- [Kaggle: NYC Taxi Trip Duration](https://www.kaggle.com/c/nyc-taxi-trip-duration)
- æ•°æ®æ—¶é—´èŒƒå›´: 2016å¹´1æœˆ-6æœˆ
- æ•°æ®å¤§å°: ~1.5M è¡Œç¨‹è®°å½•

### ç›¸å…³è®ºæ–‡
- [Distance Metrics for Geographic Coordinates](https://en.wikipedia.org/wiki/Haversine_formula)
- [Stacking Ensemble Learning](https://www.sciencedirect.com/topics/computer-science/stacking)

### æŠ€æœ¯æ–‡æ¡£
- [Scikit-learn User Guide](https://scikit-learn.org/stable/user_guide.html)
- [XGBoost Documentation](https://xgboost.readthedocs.io/)
- [Pandas Documentation](https://pandas.pydata.org/docs/)

---

## âœ… æ£€æŸ¥æ¸…å•

å®Œæˆé¡¹ç›®åŽï¼Œæ£€æŸ¥ä½ æ˜¯å¦:

### åŸºç¡€ç†è§£
- [ ] ç†è§£å®Œæ•´çš„å›žå½’é—®é¢˜æµç¨‹
- [ ] æŽŒæ¡åœ°ç†ç‰¹å¾çš„å¤„ç†æ–¹æ³•
- [ ] ä¼šä½¿ç”¨Haversineå…¬å¼è®¡ç®—è·ç¦»
- [ ] ç†è§£æ—¶é—´ç‰¹å¾çš„é‡è¦æ€§
- [ ] ç†è§£æ¨¡åž‹èžåˆçš„åŽŸç†

### æŠ€æœ¯å®žçŽ°
- [ ] ä¼šè¿›è¡Œå®Œæ•´çš„æ•°æ®é¢„å¤„ç†
- [ ] èƒ½å¤Ÿè¿›è¡Œåœ°ç†å’Œæ—¶é—´ç‰¹å¾å·¥ç¨‹
- [ ] ä¼šè®­ç»ƒå’Œè°ƒä¼˜å¤šç§å›žå½’æ¨¡åž‹
- [ ] ä¼šä½¿ç”¨äº¤å‰éªŒè¯
- [ ] ä¼šè¿›è¡Œæ®‹å·®åˆ†æž
- [ ] èƒ½å¤Ÿè§£é‡Šæ¨¡åž‹ç»“æžœ

### å·¥ç¨‹èƒ½åŠ›
- [ ] ç†è§£æ¨¡å—åŒ–ä»£ç ç»“æž„
- [ ] ä¼šç¼–å†™æ¸…æ™°çš„æ–‡æ¡£
- [ ] ä¼šä½¿ç”¨æ—¥å¿—å’Œå¼‚å¸¸å¤„ç†
- [ ] èƒ½å¤Ÿä¿å­˜å’ŒåŠ è½½æ¨¡åž‹
- [ ] å¯ä»¥åˆ›å»ºå‘½ä»¤è¡Œå·¥å…·

---

## ðŸŽ¯ ä¸‹ä¸€æ­¥

å®Œæˆæœ¬é¡¹ç›®åŽï¼Œå»ºè®®:

1. **æ·±å…¥ç†è§£å›žå½’æ¨¡åž‹**
   - å¯¹æ¯”ä¸åŒæ¨¡åž‹çš„æ•°å­¦åŽŸç†
   - ç†è§£æ­£åˆ™åŒ–çš„ä½œç”¨

2. **å®Œæˆå…¶ä»–ç›‘ç£å­¦ä¹ é¡¹ç›®**
   - æˆ¿ä»·é¢„æµ‹ï¼ˆ../01_house_price_predictionï¼‰
   - å®¢æˆ·æµå¤±é¢„æµ‹ï¼ˆ../02_customer_churn_predictionï¼‰

3. **å‚åŠ Kaggleç«žèµ›**
   - åº”ç”¨æ‰€å­¦æŠ€èƒ½
   - å­¦ä¹ Topé€‰æ‰‹çš„æ–¹æ¡ˆ

4. **æ‰©å±•é¡¹ç›®åŠŸèƒ½**
   - æ·»åŠ Webç•Œé¢
   - éƒ¨ç½²ä¸ºAPIæœåŠ¡
   - å®žçŽ°åœ¨çº¿å­¦ä¹ 

---

## ðŸ“ž åé¦ˆä¸Žè´¡çŒ®

å¦‚æžœä½ :
- å‘çŽ°ä»£ç é”™è¯¯
- æœ‰æ”¹è¿›å»ºè®®
- éœ€è¦å¸®åŠ©æˆ–æœ‰é—®é¢˜

æ¬¢è¿Žåé¦ˆï¼

---

**ç¥å­¦ä¹ é¡ºåˆ©ï¼è®°ä½ï¼šæœ€å¥½çš„å­¦ä¹ æ–¹å¼æ˜¯åŠ¨æ‰‹å®žè·µï¼** ðŸš•ðŸ“Š

---

## ðŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (2024-11-10)
- âœ… å®Œæ•´çš„é¡¹ç›®æ¡†æž¶
- âœ… 8ä¸ªæ ¸å¿ƒæ¨¡å—
- âœ… Pythonè„šæœ¬ + Jupyter Notebook
- âœ… å®Œæ•´çš„æ–‡æ¡£å’Œæ³¨é‡Š
- âœ… 8ç§å›žå½’æ¨¡åž‹
- âœ… 30+ ç‰¹å¾å·¥ç¨‹
- âœ… å®Œæ•´çš„å¯è§†åŒ–ç³»ç»Ÿ
- âœ… æ¨¡åž‹è¯„ä¼°å’Œå¯¹æ¯”
