# 📊 评估指标选择指南

> 根据业务场景和数据特征选择最合适的评估指标
>
> ⏱️ **预计用时**：15-20分钟完成指标选择

---

## 🎯 使用说明

本指南帮助你：
1. ✅ **10分钟内**根据问题类型选择主要指标
2. ✅ 理解不同指标的适用场景和权衡
3. ✅ 避免指标与业务目标不一致的错误
4. ✅ 选择合适的次要指标用于多角度评估

**前置条件**：你已经明确了问题类型（分类/回归/聚类等）
**后续步骤**：使用选定的指标进行模型评估

---

## 🗂️ 快速跳转

| 问题类型 | 跳转链接 | 常用指标 |
|----------|----------|----------|
| **二分类问题** | [二分类指标决策树](#-二分类问题指标选择) | Accuracy, F1, AUC, Precision, Recall |
| **多分类问题** | [多分类指标决策树](#-多分类问题指标选择) | Macro/Micro-F1, Weighted-F1 |
| **回归问题** | [回归指标决策树](#-回归问题指标选择) | MAE, RMSE, R², MAPE |
| **聚类问题** | [聚类指标选择](#-聚类问题指标选择) | Silhouette, Davies-Bouldin |
| **降维问题** | [降维指标选择](#-降维问题指标选择) | 解释方差比, 重构误差 |
| **业务场景映射** | [场景到指标映射表](#-业务场景到指标映射表) | 欺诈检测、医疗诊断等 |

---

## 📊 二分类问题指标选择

### 决策树

```
二分类问题
    │
    ├─ 数据平衡吗？
    │   │
    │   ├─ 是（各类别样本比例接近 1:1 至 1:3）
    │   │   │
    │   │   └─ 推荐：Accuracy（准确率）
    │   │       • 直观易懂
    │   │       • 业务可解释性强
    │   │       • 示例："模型准确率达到85%"
    │   │
    │   └─ 否（样本比例 > 1:3）
    │       │
    │       ├─ 关注假阳性代价高吗？
    │       │   │
    │       │   ├─ 是（不能误判正常样本）
    │       │   │   └─ 推荐：Precision（精确率）
    │       │   │       • 垃圾邮件检测：不能误拦正常邮件
    │       │   │       • 推荐系统：不能推荐不相关内容
    │       │   │
    │       │   └─ 否 → 继续判断
    │       │
    │       ├─ 关注假阴性代价高吗？
    │       │   │
    │       │   ├─ 是（不能漏检正样本）
    │       │   │   └─ 推荐：Recall（召回率）
    │       │   │       • 疾病诊断：不能漏诊病人
    │       │   │       • 欺诈检测（宽松版）：尽可能捕获欺诈
    │       │   │
    │       │   └─ 否 → 继续判断
    │       │
    │       └─ 假阳性和假阴性都重要？
    │           │
    │           ├─ 需要权衡 Precision 和 Recall？
    │           │   └─ 推荐：F1-Score
    │           │       • 综合考虑精确率和召回率
    │           │       • 不平衡数据的标准选择
    │           │
    │           └─ 需要评估排序质量？
    │               └─ 推荐：AUC（Area Under ROC Curve）
    │                   • 评估模型的排序能力
    │                   • 不受阈值影响
    │                   • 适合需要排序的场景（推荐、风控）
```

### 指标对比矩阵

| 指标 | 公式 | 适用场景 | 对不平衡敏感度 | 业务可解释性 |
|------|------|----------|----------------|--------------|
| **Accuracy** | (TP+TN)/(TP+TN+FP+FN) | 平衡数据 | ❌ 高（不适合不平衡） | ⭐⭐⭐⭐ 最直观 |
| **Precision** | TP/(TP+FP) | 不能误判正常样本 | ✅ 低（关注正样本） | ⭐⭐⭐ 较直观 |
| **Recall** | TP/(TP+FN) | 不能漏检正样本 | ✅ 低（关注正样本） | ⭐⭐⭐ 较直观 |
| **F1-Score** | 2·P·R/(P+R) | 综合权衡 P 和 R | ✅ 低（专为不平衡设计） | ⭐⭐ 需解释 |
| **AUC** | ROC曲线下面积 | 排序质量评估 | ✅ 低（不受阈值影响） | ⭐⭐ 需解释 |

**符号说明：**
- TP（True Positive）：真正例
- TN（True Negative）：真负例
- FP（False Positive）：假正例
- FN（False Negative）：假负例

---

## 📊 多分类问题指标选择

### 决策树

```
多分类问题
    │
    ├─ 每个类别同等重要吗？
    │   │
    │   ├─ 是（例如：多种疾病诊断，每种疾病都要准确识别）
    │   │   └─ 推荐：Macro-F1 / Macro-Precision / Macro-Recall
    │   │       • 对每个类别计算指标，然后取平均
    │   │       • 小类别和大类别权重相同
    │   │       • 示例："Macro-F1 = 0.75"
    │   │
    │   └─ 否（大类别更重要）
    │       │
    │       └─ 推荐：Micro-F1 / Weighted-F1 / Accuracy
    │           • Micro-F1：按样本数加权
    │           • Weighted-F1：按类别比例加权
    │           • Accuracy：适合平衡的多分类
    │
    └─ 需要查看每个类别的表现吗？
        │
        └─ 是 → 推荐：混淆矩阵 + 每类别的 Precision/Recall
            • 可视化每个类别的预测情况
            • 发现哪些类别容易混淆
```

### 平均方式对比

| 平均方式 | 计算方式 | 适用场景 | 对类别不平衡敏感度 |
|----------|----------|----------|-------------------|
| **Macro** | 每个类别指标的算术平均 | 每个类别同等重要 | ✅ 低（小类别影响大） |
| **Micro** | 汇总所有样本后计算 | 大类别更重要 | ❌ 高（大类别主导） |
| **Weighted** | 按类别样本数加权平均 | 根据实际分布加权 | ⚖️ 中（折中方案） |

**示例对比：**

假设有3个类别：A（100样本）、B（50样本）、C（10样本）

| 类别 | Precision | Recall | F1-Score |
|------|-----------|--------|----------|
| A | 0.90 | 0.92 | 0.91 |
| B | 0.80 | 0.85 | 0.82 |
| C | 0.50 | 0.60 | 0.55 |

- **Macro-F1** = (0.91 + 0.82 + 0.55) / 3 = **0.76** ← 小类别C拉低了分数
- **Weighted-F1** = (0.91×100 + 0.82×50 + 0.55×10) / 160 = **0.85** ← 大类别A主导
- **结论**：如果小类别C很重要（如稀有疾病），选Macro；否则选Weighted

---

## 📈 回归问题指标选择

### 决策树

```
回归问题
    │
    ├─ 关注大误差吗？
    │   │
    │   ├─ 是（大误差影响严重，如房价预测中的离谱预测）
    │   │   └─ 推荐：RMSE（Root Mean Squared Error）
    │   │       • 对大误差敏感（平方惩罚）
    │   │       • 单位与目标变量相同
    │   │       • 公式：√(Σ(y_true - y_pred)²/n)
    │   │
    │   └─ 否（关注平均误差即可）
    │       └─ 推荐：MAE（Mean Absolute Error）
    │           • 对所有误差一视同仁
    │           • 对异常值不敏感
    │           • 公式：Σ|y_true - y_pred|/n
    │
    ├─ 关注相对误差吗？
    │   │
    │   └─ 是（业务关注百分比误差，如"误差5%"）
    │       └─ 推荐：MAPE（Mean Absolute Percentage Error）
    │           • 百分比形式，业务易理解
    │           • 公式：Σ|y_true - y_pred|/y_true × 100%
    │           • ⚠️ 注意：y_true不能为0
    │
    └─ 关注拟合优度吗？
        │
        └─ 是（想知道模型解释了多少方差）
            └─ 推荐：R²（R-Squared，决定系数）
                • 范围：0-1，越高越好
                • 表示模型解释的方差比例
                • 公式：1 - (SS_res / SS_tot)
```

### 指标对比矩阵

| 指标 | 单位 | 对异常值敏感度 | 业务可解释性 | 适用场景 |
|------|------|----------------|--------------|----------|
| **MAE** | 与y相同 | ✅ 低（鲁棒） | ⭐⭐⭐ 直观 | 关注平均误差 |
| **RMSE** | 与y相同 | ❌ 高（敏感） | ⭐⭐ 需解释 | 关注大误差 |
| **R²** | 无单位 | ⚖️ 中 | ⭐⭐⭐ 直观 | 关注拟合程度 |
| **MAPE** | 百分比 | ⚖️ 中 | ⭐⭐⭐⭐ 最直观 | 关注相对误差 |

**示例对比：**

假设房价预测结果（单位：万元）：

| 真实值 | 预测值 | 误差 | 相对误差 |
|--------|--------|------|----------|
| 100 | 105 | 5 | 5% |
| 200 | 190 | 10 | 5% |
| 500 | 550 | 50 | 10% |

- **MAE** = (5 + 10 + 50) / 3 = **21.67万元**
- **RMSE** = √((5² + 10² + 50²) / 3) = **29.51万元** ← 被50万元的大误差拉高
- **MAPE** = (5% + 5% + 10%) / 3 = **6.67%**
- **R²** = 需要更多数据计算

**选择建议：**
- 房价预测 → **MAPE**（业务关心"预测误差X%"）
- 销量预测 → **MAPE** 或 **MAE**（看业务偏好）
- 温度预测 → **RMSE**（极端误差影响大）

---

## 🎯 聚类问题指标选择

### 决策树

```
聚类问题（无标签）
    │
    ├─ 有标签数据可对比吗？（用于验证聚类质量）
    │   │
    │   └─ 有 → 外部指标
    │       • Adjusted Rand Index (ARI)
    │       • Normalized Mutual Information (NMI)
    │       • 对比聚类结果与真实标签
    │
    └─ 无（纯无监督评估）→ 内部指标
        │
        ├─ 关注簇内紧密度和簇间分离度？
        │   └─ 推荐：Silhouette Score（轮廓系数）
        │       • 范围：-1 到 1，越高越好
        │       • > 0.5：聚类结构良好
        │       • 0.2-0.5：聚类结构一般
        │       • < 0.2：聚类结构较差
        │
        ├─ 需要快速计算？
        │   └─ 推荐：Davies-Bouldin Index
        │       • 值越小越好
        │       • 计算快速，适合大数据集
        │
        └─ 关注簇的凸性和分离度？
            └─ 推荐：Calinski-Harabasz Index
                • 值越大越好
                • 适合凸形簇
```

### 指标对比

| 指标 | 范围 | 越大越好/越小越好 | 计算复杂度 | 适用场景 |
|------|------|-------------------|------------|----------|
| **Silhouette Score** | [-1, 1] | 越大越好 | O(n²) | 通用首选 |
| **Davies-Bouldin** | [0, ∞) | 越小越好 | O(n) | 大数据集 |
| **Calinski-Harabasz** | [0, ∞) | 越大越好 | O(n) | 凸形簇 |

**使用建议：**
- **通用场景**：Silhouette Score（最直观）
- **大数据集**：Davies-Bouldin（快速）
- **配合业务验证**：聚类结果是否有业务可解释性

---

## 📉 降维问题指标选择

### 降维目标不同，指标不同

| 降维目的 | 推荐指标 | 说明 |
|----------|----------|------|
| **数据可视化** | 视觉效果 | 降到2D/3D后，分群是否清晰 |
| **特征提取** | 解释方差比（Explained Variance Ratio） | PCA: 前k个主成分解释了多少方差 |
| **去噪** | 重构误差（Reconstruction Error） | Autoencoder: 重构后的损失 |
| **加速训练** | 下游任务性能 | 降维后模型性能是否保持 |

### 决策流程

```
降维问题
    │
    ├─ 使用 PCA？
    │   └─ 指标：解释方差比
    │       • 前k个成分解释方差 / 总方差
    │       • 通常保留 85%-95% 的方差
    │       • 示例："前5个主成分解释了90%的方差"
    │
    ├─ 使用 t-SNE / UMAP？
    │   └─ 指标：视觉效果 + Silhouette Score
    │       • 降维后的可视化是否清晰
    │       • 配合聚类指标验证
    │
    └─ 使用 Autoencoder？
        └─ 指标：重构误差（MSE/MAE）
            • loss = MSE(原始数据, 重构数据)
            • 越小越好
```

---

## 🗺️ 业务场景到指标映射表

### 分类场景

| 业务场景 | 问题类型 | 首选指标 | 次选指标 | 原因 | 目标值 |
|----------|----------|----------|----------|------|--------|
| **信用卡欺诈检测** | 二分类（极度不平衡 1:1000） | Precision@K | Recall, F1 | 不能误判正常用户；K = 预审核能力 | Precision@1% > 0.3 |
| **疾病诊断** | 二分类（不平衡） | Recall | F1-Score | 不能漏诊（宁可误诊） | Recall > 0.95 |
| **垃圾邮件检测** | 二分类（不平衡） | Precision | F1-Score | 不能误拦正常邮件 | Precision > 0.90 |
| **客户流失预测** | 二分类（轻度不平衡） | AUC | F1-Score | 关注排序，优先干预高风险客户 | AUC > 0.75 |
| **推荐系统CTR预估** | 二分类（极度不平衡） | AUC | Precision@K | 关注排序质量 | AUC > 0.70 |
| **情感分析** | 多分类（平衡） | Macro-F1 | Accuracy | 每种情感同等重要 | Macro-F1 > 0.80 |
| **手写数字识别** | 多分类（平衡） | Accuracy | Confusion Matrix | 数据平衡，直观 | Accuracy > 0.95 |
| **新闻分类** | 多分类（不平衡） | Weighted-F1 | Macro-F1 | 大类别更常见 | Weighted-F1 > 0.85 |

### 回归场景

| 业务场景 | 问题类型 | 首选指标 | 次选指标 | 原因 | 目标值 |
|----------|----------|----------|----------|------|--------|
| **房价预测** | 回归 | MAPE | RMSE | 业务关注相对误差"误差X%" | MAPE < 10% |
| **销量预测** | 回归 | WMAPE | MAE | 不同商品权重不同 | WMAPE < 15% |
| **股票价格预测** | 回归 | MAE | RMSE | 对大误差容忍度低 | MAE < 5元 |
| **温度预测** | 回归 | RMSE | MAE | 极端误差影响大 | RMSE < 2℃ |
| **点击率预估** | 回归 | Log Loss | AUC | 概率预测，关注排序 | Log Loss < 0.5 |

### 无监督场景

| 业务场景 | 问题类型 | 首选指标 | 次选指标 | 原因 |
|----------|----------|----------|----------|------|
| **客户分群** | 聚类 | Silhouette + 业务验证 | Davies-Bouldin | 业务可解释性最重要 |
| **异常检测** | 异常检测 | Precision@K | Recall | K = 人工审核能力 |
| **数据降维可视化** | 降维 | 视觉效果 | 解释方差比 | 可视化清晰度优先 |
| **特征提取** | 降维 | 解释方差比 | 下游任务性能 | 保留足够信息 |

---

## ⚖️ 指标权衡分析

### Precision vs Recall 权衡

```
业务场景决策：

假阳性代价高（不能误判正常）
    ↓
优先 Precision
    │
    ├─ 垃圾邮件检测：不能误拦正常邮件
    ├─ 推荐系统：不能推荐不相关内容
    └─ 信用审批：不能拒绝优质客户

假阴性代价高（不能漏检异常）
    ↓
优先 Recall
    │
    ├─ 疾病诊断：不能漏诊病人
    ├─ 欺诈检测：不能放过欺诈
    └─ 质量检测：不能放过不合格品

两者都重要？
    ↓
使用 F1-Score 或 AUC
    │
    ├─ F1-Score：综合权衡 P 和 R
    └─ AUC：不受阈值影响，评估排序质量
```

### MAE vs RMSE 权衡

| 场景 | 选择 | 原因 |
|------|------|------|
| **房价预测** | MAPE > RMSE > MAE | 关注相对误差，大误差有一定影响 |
| **销量预测** | MAPE > MAE > RMSE | 关注相对误差，对大误差容忍度高 |
| **温度预测** | RMSE > MAE > MAPE | 极端误差影响大（如预警） |
| **股票预测** | MAE ≈ RMSE | 大误差和平均误差都重要 |

---

## 🎯 实战案例

### 案例1：客户流失预测的指标选择全过程

**背景：**
- 电信公司预测客户流失
- 历史数据：10000个客户，流失率15%（正负样本 15:85）
- 业务目标：提前识别流失客户，进行优惠挽留
- 约束：每月只能主动联系1000个客户（预算限制）

**Step 1: 确定问题类型**
- 二分类问题（流失/不流失）
- 数据轻度不平衡（15:85）

**Step 2: 分析业务需求**

业务关注点：
1. **排序质量**：需要优先联系最可能流失的客户（资源有限）
2. **召回率**：希望能捕获大部分流失客户
3. **精确率**：不希望浪费资源联系不会流失的客户

**Step 3: 指标选择决策**

根据决策树：
```
二分类 + 不平衡 + 需要排序
    ↓
首选：AUC
次选：Recall@1000（捕获率@Top1000）
监控：Precision@1000
```

**Step 4: 最终指标组合**

| 指标 | 角色 | 目标值 | 原因 |
|------|------|--------|------|
| **AUC** | 主要指标 | > 0.75 | 评估模型整体排序质量 |
| **Recall@10%** | 次要指标 | > 0.60 | Top 10%能捕获60%流失客户 |
| **Precision@10%** | 监控指标 | > 0.35 | 联系的1000人中350+是真流失 |

**Step 5: 业务转化**

向业务部门汇报：
> "模型AUC达到0.78，在每月联系1000个客户的情况下，能捕获65%的流失客户，
> 其中约38%确实会流失（精确率0.38），相比随机选择（15%）提升2.5倍。"

---

### 案例2：房价预测的指标权衡

**背景：**
- 房产中介需要快速估价
- 价格范围：50万 - 1000万
- 业务目标：误差控制在10%以内

**Step 1: 候选指标**

| 指标 | 计算结果 | 优点 | 缺点 |
|------|----------|------|------|
| MAE | 45万元 | 直观，鲁棒 | 不知道相对误差 |
| RMSE | 68万元 | 惩罚大误差 | 受极端值影响 |
| MAPE | 8.5% | 业务易理解 | 低价房误差权重大 |
| R² | 0.85 | 表示拟合程度 | 不直观 |

**Step 2: 业务场景分析**

房产中介关心：
- "预测误差5%"（相对误差）
- 极端误差影响信誉（如预测200万，实际100万）

**Step 3: 最终选择**

| 指标 | 角色 | 目标值 | 原因 |
|------|------|--------|------|
| **MAPE** | 主要指标 | < 10% | 业务直接理解"误差X%" |
| **RMSE** | 次要指标 | < 50万 | 控制极端误差 |
| **R²** | 监控指标 | > 0.80 | 确保整体拟合质量 |

---

### 案例3：多分类问题的指标权衡（垃圾邮件多分类）

**背景：**
- 邮件分类：正常邮件（80%）、推广邮件（15%）、垃圾邮件（4%）、钓鱼邮件（1%）
- 业务目标：准确分类，特别不能漏掉钓鱼邮件

**Step 1: 候选指标**

| 指标 | 计算结果 | 分析 |
|------|----------|------|
| Accuracy | 0.90 | 被正常邮件主导（80%） |
| Macro-F1 | 0.65 | 钓鱼邮件拉低分数（小类别权重大） |
| Weighted-F1 | 0.88 | 大类别权重大 |

**Step 2: 业务需求分析**

| 类别 | 样本占比 | 业务重要性 | 漏分代价 |
|------|----------|------------|----------|
| 正常邮件 | 80% | 中 | 中等 |
| 推广邮件 | 15% | 低 | 低 |
| 垃圾邮件 | 4% | 中 | 中等 |
| 钓鱼邮件 | 1% | **极高** | **极高** |

**Step 3: 最终指标组合**

| 指标 | 角色 | 目标值 | 原因 |
|------|------|--------|------|
| **Macro-F1** | 主要指标 | > 0.70 | 确保小类别也被重视 |
| **钓鱼邮件 Recall** | 核心指标 | > 0.90 | 不能漏掉钓鱼邮件 |
| **正常邮件 Precision** | 监控指标 | > 0.95 | 不能误拦正常邮件 |
| **Confusion Matrix** | 分析工具 | - | 查看类别间混淆情况 |

---

## 🚫 常见错误和避免方法

### 错误1：不平衡数据用 Accuracy

**❌ 错误示例：**
- 欺诈检测（正负样本1:99），Accuracy = 99%
- 看起来很高，但模型可能只是预测所有样本为"正常"

**✅ 正确做法：**
- 使用 F1-Score 或 Precision@K
- 查看混淆矩阵，确认两个类别都有预测

**避免方法：**
```python
# 检查数据平衡情况
from collections import Counter
class_dist = Counter(y_train)
imbalance_ratio = max(class_dist.values()) / min(class_dist.values())

if imbalance_ratio > 3:
    print("⚠️ 数据不平衡，不要使用 Accuracy！")
    print("推荐使用：F1-Score, AUC, Precision@K")
```

---

### 错误2：指标与业务目标不一致

**❌ 错误示例：**
- 疾病诊断用 Precision 评估 → 漏诊风险高
- 房价预测用 R² 向业务汇报 → 业务不理解"解释方差"

**✅ 正确做法：**
- 疾病诊断用 Recall（不能漏诊）
- 房价预测用 MAPE（业务理解"误差5%"）

**避免方法：**
- 使用本文档的 [业务场景映射表](#-业务场景到指标映射表)
- 与业务部门确认：他们关心什么？

---

### 错误3：忽略多个指标的组合

**❌ 错误示例：**
- 只看 F1-Score = 0.80，但 Precision = 0.60, Recall = 0.95
- 这意味着误报率很高（40%的预测是错的）

**✅ 正确做法：**
- 使用主要指标 + 次要指标 + 监控指标
- 查看混淆矩阵和分类报告

**避免方法：**
```python
from sklearn.metrics import classification_report, confusion_matrix

# 查看完整报告
print(classification_report(y_true, y_pred))
print(confusion_matrix(y_true, y_pred))
```

---

## ✅ 指标选择检查清单

完成指标选择后，检查：

- [ ] **已确定问题类型**（分类/回归/聚类）
- [ ] **分析了数据特征**（平衡性、样本量、噪声）
- [ ] **明确了业务需求**（关注什么？代价是什么？）
- [ ] **选择了主要指标**（1个，用于模型选择）
- [ ] **选择了次要指标**（1-2个，多角度评估）
- [ ] **设定了目标值**（如：AUC > 0.75）
- [ ] **确认业务可解释性**（业务部门能理解吗？）
- [ ] **避免了常见错误**（不平衡用Accuracy、指标与目标不一致）

---

## 🔗 下一步

完成指标选择后：

1. **记录到问题定义文档**
   - 使用 [problem_definition_checklist.md](problem_definition_checklist.md) 的模板
   - 明确写下：主要指标、次要指标、目标值

2. **进入算法选择阶段**
   - 查看 [03_算法选择矩阵](../03_algorithm_selection_matrix/)
   - 根据问题类型和数据特征选择算法

3. **准备模型评估**
   - 查看 [05_模型评估](../05_model_evaluation/)
   - 使用选定的指标评估模型

---

**最后提醒：**

> 💡 指标选择比模型选择更重要！
> 💡 好的指标 = 业务目标 + 数据特征 + 约束条件
> 💡 不确定时，参考同类业务的benchmark！

---

**准备好了吗？**

👉 **下一步**：使用 [problem_definition_checklist.md](problem_definition_checklist.md) 完成完整的问题定义
